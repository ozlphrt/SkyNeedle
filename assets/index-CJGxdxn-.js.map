{"version":3,"file":"index-CJGxdxn-.js","sources":["../../src/airportLoader.js","../../src/main.js"],"sourcesContent":["import * as Cesium from 'cesium';\r\n\r\n/**\r\n * Fetch airport details JSON\r\n */\r\nexport async function fetchAirportDetails() {\r\n    try {\r\n        const response = await fetch(`${import.meta.env.BASE_URL}assets/airport_details.json`);\r\n        if (!response.ok) throw new Error('Failed to load airport details');\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error('‚ùå Error fetching airport details:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n/**\r\n * Load and render runway/taxiway surfaces\r\n * and upgrade airport labels to 3D blocks on the main runway.\r\n * @param {Cesium.Viewer} viewer The Cesium viewer instance\r\n//  * @param {Object} app The global app object containing filter state\r\n * @param {Object} data The airport details data (optional, fetched if not provided)\r\n */\r\nexport async function loadRunwaySurfaces(viewer, app, data = null) {\r\n    console.log('Loading airport surfaces...');\r\n    try {\r\n        if (!data) {\r\n            data = await fetchAirportDetails();\r\n        }\r\n\r\n        if (!data) return;\r\n\r\n        // Create a data source for airport surfaces\r\n        const dataSource = new Cesium.CustomDataSource('airport-surfaces');\r\n        viewer.dataSources.add(dataSource);\r\n\r\n        Object.entries(data).forEach(([icao, details]) => {\r\n            let longestRunway = null;\r\n            let maxLength = 0;\r\n\r\n            // Render Runways\r\n            if (details.runways) {\r\n                details.runways.forEach(feature => {\r\n                    const diffCoords = feature.geometry.coordinates;\r\n                    // Flatten coordinates for Cesium\r\n                    const positions = diffCoords.flat();\r\n                    const cartesians = Cesium.Cartesian3.fromDegreesArray(positions);\r\n\r\n                    dataSource.entities.add({\r\n                        corridor: {\r\n                            positions: cartesians,\r\n                            width: 45.0, // 45 meters wide\r\n                            material: Cesium.Color.fromCssColorString('#00ff41').withAlpha(0.3), // Cyber Green\r\n                            cornerType: Cesium.CornerType.MITERED,\r\n                            heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,\r\n                            // Only show when camera is relatively close (200km)\r\n                            distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 200000)\r\n                        },\r\n                        // Add metadata for click interaction\r\n                        properties: {\r\n                            type: 'airport',\r\n                            icao: icao,\r\n                            name: `Airport ${icao}`\r\n                        }\r\n                    });\r\n\r\n                    // Calculate length to find the main runway\r\n                    let length = 0;\r\n                    for (let i = 0; i < cartesians.length - 1; i++) {\r\n                        length += Cesium.Cartesian3.distance(cartesians[i], cartesians[i + 1]);\r\n                    }\r\n\r\n                    if (length > maxLength) {\r\n                        maxLength = length;\r\n                        longestRunway = cartesians;\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Render Taxiways\r\n            if (details.taxiways) {\r\n                details.taxiways.forEach(feature => {\r\n                    const diffCoords = feature.geometry.coordinates;\r\n                    const positions = diffCoords.flat();\r\n\r\n                    dataSource.entities.add({\r\n                        corridor: {\r\n                            positions: Cesium.Cartesian3.fromDegreesArray(positions),\r\n                            width: 20.0, // 20 meters wide\r\n                            material: Cesium.Color.fromCssColorString('#00ff41').withAlpha(0.15), // Fainter Green\r\n                            cornerType: Cesium.CornerType.ROUNDED,\r\n                            heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,\r\n                            distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 200000)\r\n                        },\r\n                        // Add metadata for click interaction\r\n                        properties: {\r\n                            type: 'airport',\r\n                            icao: icao,\r\n                            name: `Airport ${icao}`\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n\r\n            // Upgrade the existing airport marker if we found a main runway\r\n            if (longestRunway) {\r\n                const airportEntity = viewer.entities.getById(`airport-${icao}`);\r\n                if (airportEntity) {\r\n                    console.log(`[SkyNeedle] Upgrading airport ${icao} - Hiding generic label/pin`);\r\n                    // Calculate center of the longest runway\r\n                    const p1 = longestRunway[0];\r\n                    const p2 = longestRunway[longestRunway.length - 1];\r\n                    const center = Cesium.Cartesian3.midpoint(p1, p2, new Cesium.Cartesian3());\r\n\r\n                    // Move entity\r\n                    airportEntity.position = center;\r\n\r\n                    // HIDE VISUALS?\r\n                    // User requested to KEEP the white dot and label even with overlays.\r\n                    // So we removed the lines hiding point and label.\r\n                    if (airportEntity.billboard) airportEntity.billboard.show = false; // Legacy cleanup\r\n                } else {\r\n                    console.warn(`[SkyNeedle] Airport entity 'airport-${icao}' not found in viewer entities`);\r\n                }\r\n            } else {\r\n                console.log(`[SkyNeedle] No main runway found for ${icao}, generic label remains visible`);\r\n            }\r\n        });\r\n\r\n        console.log('‚úÖ Airport surfaces loaded and labels updated');\r\n\r\n    } catch (error) {\r\n        console.error('‚ùå Error loading airport details:', error);\r\n    }\r\n}\r\n","/**\r\n * SkyNeedle - Main Application Entry Point\r\n * 3D Flight Tracking PWA\r\n */\r\n\r\nimport * as Cesium from 'cesium';\r\nimport 'cesium/Build/Cesium/Widgets/widgets.css';\r\nimport { loadRunwaySurfaces } from './airportLoader.js';\r\n\r\n// Configuration - Using environment variables\r\nconst CESIUM_ION_TOKEN = import.meta.env.VITE_CESIUM_ION_TOKEN || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3N2VmNjQ5YS00MzNiLTRjODUtYTYwMS1hZjIwOGM3YWFkMDUiLCJpZCI6MzgwMzQwLCJpYXQiOjE3Njg3NDA5ODB9.ILdx02CrRUguqA-msX6n5l9-NRFuF6oHPGtqlgabJB4';\r\nconst OPENSKY_USERNAME = import.meta.env.VITE_OPENSKY_USERNAME || '';\r\nconst OPENSKY_PASSWORD = import.meta.env.VITE_OPENSKY_PASSWORD || '';\r\nconst MAX_AIRCRAFT_DISPLAY = 500; // Maximum number of aircraft to display at once\r\n\r\n// common ICAO airline codes for lookup\r\n// Airline Data with IATA Codes\r\nconst ICAO_AIRLINES = {\r\n    'THY': { name: 'Turkish Airlines', iata: 'TK' },\r\n    'PGT': { name: 'Pegasus Airlines', iata: 'PC' },\r\n    'BAW': { name: 'British Airways', iata: 'BA' },\r\n    'DLH': { name: 'Lufthansa', iata: 'LH' },\r\n    'AFR': { name: 'Air France', iata: 'AF' },\r\n    'KLM': { name: 'KLM Royal Dutch', iata: 'KL' },\r\n    'UAE': { name: 'Emirates', iata: 'EK' },\r\n    'QTR': { name: 'Qatar Airways', iata: 'QR' },\r\n    'ETD': { name: 'Etihad Airways', iata: 'EY' },\r\n    'DL': { name: 'Delta Air Lines', iata: 'DL' },\r\n    'AAL': { name: 'American Airlines', iata: 'AA' },\r\n    'UAL': { name: 'United Airlines', iata: 'UA' },\r\n    'RYR': { name: 'Ryanair', iata: 'FR' },\r\n    'EZY': { name: 'EasyJet', iata: 'U2' },\r\n    'WZZ': { name: 'Wizz Air', iata: 'W6' },\r\n    'SWR': { name: 'Swiss International', iata: 'LX' },\r\n    'AZA': { name: 'Alitalia', iata: 'AZ' },\r\n    'TAP': { name: 'TAP Air Portugal', iata: 'TP' },\r\n    'LOT': { name: 'LOT Polish Airlines', iata: 'LO' },\r\n    'ELY': { name: 'El Al', iata: 'LY' },\r\n    'FDB': { name: 'FlyDubai', iata: 'FZ' },\r\n    'RJA': { name: 'Royal Jordanian', iata: 'RJ' },\r\n    'MEA': { name: 'Middle East Airlines', iata: 'ME' },\r\n    'MSR': { name: 'EgyptAir', iata: 'MS' },\r\n    'RAM': { name: 'Royal Air Maroc', iata: 'AT' },\r\n    'ETH': { name: 'Ethiopian Airlines', iata: 'ET' },\r\n    'SVA': { name: 'Saudia', iata: 'SV' },\r\n    'QFA': { name: 'Qantas', iata: 'QF' },\r\n    'JAL': { name: 'Japan Airlines', iata: 'JL' },\r\n    'ANA': { name: 'All Nippon Airways', iata: 'NH' },\r\n    'CPA': { name: 'Cathay Pacific', iata: 'CX' },\r\n    'PIA': { name: 'Pakistan International', iata: 'PK' },\r\n    'AIC': { name: 'Air India', iata: 'AI' },\r\n    'CCA': { name: 'Air China', iata: 'CA' },\r\n    'CES': { name: 'China Eastern', iata: 'MU' },\r\n    'CSN': { name: 'China Southern', iata: 'CZ' },\r\n    'MAS': { name: 'Malaysia Airlines', iata: 'MH' },\r\n    'SIA': { name: 'Singapore Airlines', iata: 'SQ' },\r\n    'THA': { name: 'Thai Airways', iata: 'TG' },\r\n    'KAL': { name: 'Korean Air', iata: 'KE' },\r\n    'ANZ': { name: 'Air New Zealand', iata: 'NZ' },\r\n    'ACA': { name: 'Air Canada', iata: 'AC' },\r\n    'AMX': { name: 'Aeromexico', iata: 'AM' },\r\n    'LAN': { name: 'LATAM Airlines', iata: 'LA' },\r\n    'AVA': { name: 'Avianca', iata: 'AV' }\r\n};\r\n\r\nconst AIRPORTS = [\r\n    { name: 'Istanbul Airport', icao: 'LTFM', lat: 41.275, lon: 28.751, alt: 99 },\r\n    { name: 'Sabiha Gokcen', icao: 'LTFJ', lat: 40.898, lon: 29.309, alt: 93 },\r\n    { name: 'Ankara Esenboga', icao: 'LTAC', lat: 40.128, lon: 32.995, alt: 953 },\r\n    { name: 'Izmir Adnan Menderes', icao: 'LTBJ', lat: 38.292, lon: 27.157, alt: 126 },\r\n    { name: 'Antalya Airport', icao: 'LTAI', lat: 36.899, lon: 30.801, alt: 54 },\r\n    { name: 'Milas-Bodrum', icao: 'LTFE', lat: 37.250, lon: 27.664, alt: 6 },\r\n    { name: 'Dalaman Airport', icao: 'LTBS', lat: 36.716, lon: 28.791, alt: 6 },\r\n    { name: 'Adana Sakirpasa', icao: 'LTAF', lat: 36.982, lon: 35.280, alt: 20 },\r\n    { name: 'Trabzon Airport', icao: 'LTCG', lat: 40.995, lon: 39.789, alt: 31 },\r\n    { name: 'JFK International', icao: 'KJFK', lat: 40.645, lon: -73.785, alt: 10 },\r\n    { name: 'Heathrow Airport', icao: 'EGLL', lat: 51.470, lon: -0.454, alt: 25 },\r\n    { name: 'Frankfurt Airport', icao: 'EDDF', lat: 50.037, lon: 8.562, alt: 111 },\r\n    { name: 'Dubai International', icao: 'OMDB', lat: 25.253, lon: 55.365, alt: 19 }\r\n];\r\n\r\n// Set Cesium Ion token\r\nCesium.Ion.defaultAccessToken = CESIUM_ION_TOKEN;\r\n\r\n// Application state\r\nconst app = {\r\n    viewer: null,\r\n    selectedAircraft: null,\r\n    aircraftEntities: new Map(),\r\n    updateInterval: null,\r\n    lastFetchBounds: null,\r\n    cameraMoveTimeout: null,\r\n    lastAircraftData: [], // Store raw data for re-filtering\r\n    filters: {\r\n        showAirports: true,\r\n        showTraces: false\r\n    },\r\n    searchQuery: '', // Search query string\r\n    trackedEntity: null,\r\n    followMode: 'NONE', // 'NONE', 'TRACK', 'FOLLOW', 'COCKPIT'\r\n    geocoder: null, // Geocoder service\r\n    searchTimeout: null, // Timeout for debouncing search\r\n    // Debug mode for manual alignment\r\n    debugMode: false,\r\n    debugOffsets: {\r\n        x: 0.0,  // Left/Right (meters)\r\n        y: 0.0,  // Forward/Backward (meters)\r\n        z: 0.0   // Up/Down (meters)\r\n    },\r\n    selectionBracket: null // Selection bracket entity\r\n};\r\n\r\n/**\r\n * Initialize Cesium Viewer\r\n */\r\nasync function initCesiumViewer() {\r\n    console.log('Initializing Cesium viewer...');\r\n\r\n    // Debug: Check if credentials are loaded\r\n    console.log('Environment check:', {\r\n        hasUsername: !!OPENSKY_USERNAME,\r\n        username: OPENSKY_USERNAME || '(not set)',\r\n        hasPassword: !!OPENSKY_PASSWORD\r\n    });\r\n\r\n    app.viewer = new Cesium.Viewer('cesiumContainer', {\r\n        // Terrain and imagery\r\n        terrain: Cesium.Terrain.fromWorldTerrain(),\r\n        baseLayer: (function () {\r\n            const layer = Cesium.ImageryLayer.fromWorldImagery({\r\n                style: Cesium.IonWorldImageryStyle.AERIAL\r\n            });\r\n            layer.brightness = 0.6;\r\n            layer.contrast = 1.2;\r\n            layer.saturation = 0.2;\r\n            return layer;\r\n        })(),\r\n\r\n        // Disable default UI\r\n        animation: false,\r\n        timeline: false,\r\n        infoBox: false,\r\n        selectionIndicator: false,\r\n        baseLayerPicker: false,\r\n        geocoder: false,\r\n        homeButton: false,\r\n        sceneModePicker: false,\r\n        navigationHelpButton: false,\r\n        fullscreenButton: false,\r\n\r\n        // Scene settings - remove empty skybox to prevent errors\r\n        skyAtmosphere: false,\r\n\r\n        // Performance\r\n        // Performance - requestRenderMode disabled for smoother animations of moving objects\r\n        requestRenderMode: false,\r\n        maximumRenderTimeChange: Infinity\r\n    });\r\n\r\n    // Ensure animation is enabled for aircraft movement\r\n    app.viewer.clock.shouldAnimate = true;\r\n    app.viewer.clock.clockRange = Cesium.ClockRange.UNBOUNDED;\r\n\r\n    // Configure scene\r\n    const scene = app.viewer.scene;\r\n    scene.globe.baseColor = Cesium.Color.fromCssColorString('#0a0e14');\r\n    scene.backgroundColor = Cesium.Color.fromCssColorString('#000000');\r\n    scene.globe.enableLighting = false; // Disable sun lighting on globe\r\n\r\n    // Initialize Geocoder Service (Now with scene reference)\r\n    app.geocoder = new Cesium.IonGeocoderService({ scene: scene });\r\n\r\n    // FIX LIGHTING: Add a fixed directional light for 3D models (like the aircraft)\r\n    scene.light = new Cesium.DirectionalLight({\r\n        direction: new Cesium.Cartesian3(0.0, 0.0, -1.0), // Illuminating straight down\r\n        intensity: 2.0\r\n    });\r\n\r\n    // Set initial camera position (over Bodrum, Turkey)\r\n    app.viewer.camera.setView({\r\n        destination: Cesium.Cartesian3.fromDegrees(27.43, 37.04, 200000),\r\n        orientation: {\r\n            heading: 0.0,\r\n            pitch: -Cesium.Math.PI_OVER_TWO,\r\n            roll: 0.0\r\n        }\r\n    });\r\n\r\n    // Hook into the render loop for camera updates\r\n    app.viewer.scene.preUpdate.addEventListener(updateCamera);\r\n\r\n    // Initialize Selection Bracket\r\n    createSelectionBracket();\r\n\r\n    // Initialize Airports\r\n    initializeAirports();\r\n\r\n    // Load Runway and Taxiway Details\r\n    loadRunwaySurfaces(app.viewer, app);\r\n\r\n    // REMOVED: Real-time UI updates (per user request to fix inconsistencies)\r\n    // app.viewer.scene.preUpdate.addEventListener(updateSelectedAircraftUI);\r\n\r\n    console.log('Cesium viewer initialized');\r\n}\r\n\r\n/**\r\n * Load and render runway/taxiway surfaces\r\n */\r\nasync function loadRunwaySurfaces_OLD() {\r\n    console.log('Loading airport details...');\r\n    try {\r\n        const response = await fetch(`${import.meta.env.BASE_URL}assets/airport_details.json`);\r\n        if (!response.ok) throw new Error('Failed to load airport details');\r\n\r\n        const data = await response.json();\r\n\r\n        // Create a data source for airport surfaces\r\n        const dataSource = new Cesium.CustomDataSource('airport-surfaces');\r\n        app.viewer.dataSources.add(dataSource);\r\n\r\n        Object.entries(data).forEach(([icao, details]) => {\r\n            // Render Runways\r\n            if (details.runways) {\r\n                details.runways.forEach(feature => {\r\n                    const diffCoords = feature.geometry.coordinates;\r\n                    // Flatten coordinates for Cesium\r\n                    const positions = diffCoords.flat();\r\n\r\n                    dataSource.entities.add({\r\n                        show: new Cesium.CallbackProperty(() => app.filters.showAirports, false),\r\n                        corridor: {\r\n                            positions: Cesium.Cartesian3.fromDegreesArray(positions),\r\n                            width: 45.0, // 45 meters wide\r\n                            material: Cesium.Color.fromCssColorString('#00ff41').withAlpha(0.3), // Cyber Green\r\n                            cornerType: Cesium.CornerType.MITERED,\r\n                            heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,\r\n                            // Only show when camera is relatively close\r\n                            distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 200000)\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n\r\n            // Render Taxiways\r\n            if (details.taxiways) {\r\n                details.taxiways.forEach(feature => {\r\n                    const diffCoords = feature.geometry.coordinates;\r\n                    const positions = diffCoords.flat();\r\n\r\n                    dataSource.entities.add({\r\n                        corridor: {\r\n                            positions: Cesium.Cartesian3.fromDegreesArray(positions),\r\n                            width: 20.0, // 20 meters wide\r\n                            material: Cesium.Color.fromCssColorString('#00ff41').withAlpha(0.15), // Fainter Green\r\n                            cornerType: Cesium.CornerType.ROUNDED,\r\n                            heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,\r\n                            distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 200000)\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n        });\r\n\r\n        console.log('‚úÖ Airport surfaces loaded');\r\n\r\n    } catch (error) {\r\n        console.error('‚ùå Error loading airport details:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Create custom selection bracket entity\r\n */\r\nfunction createSelectionBracket() {\r\n    if (!app.viewer) return;\r\n\r\n    // Create a canvas for the bracket\r\n    const size = 64;\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = size;\r\n    canvas.height = size;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    const color = '#00ff41';\r\n    const thickness = 4;\r\n    const len = 16;\r\n\r\n    ctx.strokeStyle = color;\r\n    ctx.lineWidth = thickness;\r\n    ctx.lineCap = 'round';\r\n\r\n    // Top Left\r\n    ctx.beginPath();\r\n    ctx.moveTo(thickness, thickness + len);\r\n    ctx.lineTo(thickness, thickness);\r\n    ctx.lineTo(thickness + len, thickness);\r\n    ctx.stroke();\r\n\r\n    // Top Right\r\n    ctx.beginPath();\r\n    ctx.moveTo(size - thickness - len, thickness);\r\n    ctx.lineTo(size - thickness, thickness);\r\n    ctx.lineTo(size - thickness, thickness + len);\r\n    ctx.stroke();\r\n\r\n    // Bottom Left\r\n    ctx.beginPath();\r\n    ctx.moveTo(thickness, size - thickness - len);\r\n    ctx.lineTo(thickness, size - thickness);\r\n    ctx.lineTo(thickness + len, size - thickness);\r\n    ctx.stroke();\r\n\r\n    // Bottom Right\r\n    ctx.beginPath();\r\n    ctx.moveTo(size - thickness - len, size - thickness);\r\n    ctx.lineTo(size - thickness, size - thickness);\r\n    ctx.lineTo(size - thickness, size - thickness - len);\r\n    ctx.stroke();\r\n\r\n    app.selectionBracket = app.viewer.entities.add({\r\n        id: 'selection-bracket',\r\n        show: false,\r\n        billboard: {\r\n            image: canvas,\r\n            scale: 1.0,\r\n            horizontalOrigin: Cesium.HorizontalOrigin.CENTER,\r\n            verticalOrigin: Cesium.VerticalOrigin.CENTER,\r\n            disableDepthTestDistance: Number.POSITIVE_INFINITY, // Always on top\r\n            pixelOffset: new Cesium.Cartesian2(0, 0)\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Initialize Airport Markers\r\n * @param {Array<string>} hiddenIcaos - List of airport ICAOs to hide (because they have detailed surfaces)\r\n */\r\nfunction initializeAirports(hiddenIcaos = []) {\r\n    if (!app.viewer) return;\r\n\r\n    const pinBuilder = new Cesium.PinBuilder();\r\n\r\n    AIRPORTS.forEach(airport => {\r\n        // Check if this airport has detailed surfaces (should be hidden)\r\n        const shouldHideVisuals = hiddenIcaos.includes(airport.icao);\r\n\r\n        const entityOptions = {\r\n            id: `airport-${airport.icao}`,\r\n            position: Cesium.Cartesian3.fromDegrees(airport.lon, airport.lat, airport.alt),\r\n            properties: {\r\n                type: 'airport',\r\n                name: airport.name,\r\n                icao: airport.icao\r\n            }\r\n        };\r\n\r\n        // Only add visuals if NOT in the hidden list\r\n        if (!shouldHideVisuals) {\r\n            entityOptions.point = {\r\n                pixelSize: 8,\r\n                color: Cesium.Color.WHITE.withAlpha(0.8),\r\n                outlineColor: Cesium.Color.BLACK,\r\n                outlineWidth: 1,\r\n                heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,\r\n                show: new Cesium.CallbackProperty(() => app.filters.showAirports, false),\r\n                distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 5000000) // Show from further away\r\n            };\r\n            entityOptions.label = {\r\n                text: airport.name,\r\n                font: '12px Inter, sans-serif', // Cleaner font\r\n                style: Cesium.LabelStyle.FILL_AND_OUTLINE,\r\n                fillColor: Cesium.Color.WHITE,\r\n                outlineColor: Cesium.Color.BLACK,\r\n                outlineWidth: 2,\r\n                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,\r\n                pixelOffset: new Cesium.Cartesian2(0, -10), // Above the dot\r\n                distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 500000), // Hide labels when zoomed out\r\n                show: new Cesium.CallbackProperty(() => app.filters.showAirports, false)\r\n            };\r\n        }\r\n\r\n        app.viewer.entities.add(entityOptions);\r\n    });\r\n}\r\n\r\n/**\r\n * Get current camera viewport bounds\r\n */\r\nfunction getCameraViewportBounds() {\r\n    if (!app.viewer) return null;\r\n\r\n    const camera = app.viewer.camera;\r\n    const canvas = app.viewer.scene.canvas;\r\n\r\n    // Get corners of the viewport\r\n    const topLeft = camera.pickEllipsoid(new Cesium.Cartesian2(0, 0), app.viewer.scene.globe.ellipsoid);\r\n    const topRight = camera.pickEllipsoid(new Cesium.Cartesian2(canvas.clientWidth, 0), app.viewer.scene.globe.ellipsoid);\r\n    const bottomLeft = camera.pickEllipsoid(new Cesium.Cartesian2(0, canvas.clientHeight), app.viewer.scene.globe.ellipsoid);\r\n    const bottomRight = camera.pickEllipsoid(new Cesium.Cartesian2(canvas.clientWidth, canvas.clientHeight), app.viewer.scene.globe.ellipsoid);\r\n\r\n    // If camera is too far out (space view), return null to fetch all aircraft\r\n    if (!topLeft || !topRight || !bottomLeft || !bottomRight) {\r\n        return null;\r\n    }\r\n\r\n    // Convert to geographic coordinates\r\n    const corners = [topLeft, topRight, bottomLeft, bottomRight].map(cartesian => {\r\n        const cartographic = Cesium.Cartographic.fromCartesian(cartesian);\r\n        return {\r\n            lat: Cesium.Math.toDegrees(cartographic.latitude),\r\n            lon: Cesium.Math.toDegrees(cartographic.longitude)\r\n        };\r\n    });\r\n\r\n    // Calculate bounding box\r\n    const lats = corners.map(c => c.lat);\r\n    const lons = corners.map(c => c.lon);\r\n\r\n    return {\r\n        lamin: Math.max(-90, Math.min(...lats)),   // South (clamp to valid range)\r\n        lamax: Math.min(90, Math.max(...lats)),    // North\r\n        lomin: Math.max(-180, Math.min(...lons)),  // West\r\n        lomax: Math.min(180, Math.max(...lons))    // East\r\n    };\r\n}\r\n\r\n/**\r\n * Fetch aircraft data from OpenSky Network\r\n */\r\nasync function fetchAircraftData(bounds = null) {\r\n    try {\r\n        // Use provided bounds, or calculate from camera viewport\r\n        let bbox = bounds;\r\n\r\n        if (!bbox) {\r\n            bbox = getCameraViewportBounds();\r\n        }\r\n\r\n        // If still no bounds (camera too far out), use a reasonable default\r\n        if (!bbox) {\r\n            console.log('Camera view too wide, fetching limited region');\r\n            bbox = {\r\n                lamin: 35.8,   // South (Turkey region)\r\n                lamax: 42.1,   // North\r\n                lomin: 25.6,   // West\r\n                lomax: 44.8    // East\r\n            };\r\n        }\r\n\r\n        console.log('Fetching aircraft for bounds:', bbox);\r\n\r\n        // Detect environment - use Render backend in production, local proxy in development\r\n        const isProduction = window.location.hostname === 'ozlphrt.github.io';\r\n        const API_BASE = isProduction\r\n            ? 'https://skyneedle-api.onrender.com'\r\n            : '';\r\n\r\n        // Use relative path in development (Vite proxy forwards to localhost:3002)\r\n        // Use absolute URL in production (points to Render backend)\r\n        const url = `${API_BASE}/api/states/all?lamin=${bbox.lamin}&lomin=${bbox.lomin}&lamax=${bbox.lamax}&lomax=${bbox.lomax}`;\r\n\r\n        console.log(`API Request: ${isProduction ? 'PRODUCTION' : 'DEVELOPMENT'} ‚Üí ${url}`);\r\n\r\n        // No need for client-side headers - the proxy handles authentication\r\n        const response = await fetch(url);\r\n\r\n        if (!response.ok) {\r\n            const errorText = await response.text();\r\n            console.error('‚ùå API Error:', {\r\n                status: response.status,\r\n                statusText: response.statusText,\r\n                response: errorText\r\n            });\r\n\r\n            if (response.status === 401) {\r\n                console.error('üîí Authentication failed - check server logs');\r\n            } else if (response.status === 429) {\r\n                console.error('‚è±Ô∏è Rate limit exceeded - reduce request frequency');\r\n            }\r\n\r\n            throw new Error(`OpenSky API error: ${response.status} ${response.statusText}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        console.log(`‚úÖ Fetched ${data.states?.length || 0} aircraft in viewport`);\r\n\r\n        return data.states || [];\r\n    } catch (error) {\r\n        console.error('‚ùå Error fetching aircraft data:', error);\r\n\r\n        // Check if proxy server is running\r\n        if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {\r\n            console.error('üí° Is the proxy server running? Run \"npm run server\" in a separate terminal.');\r\n            updateStatus('ERROR: PROXY DISCONNECTED', true);\r\n            return [];\r\n        }\r\n\r\n        updateStatus('ERROR: API UNAVAILABLE', true);\r\n        return [];\r\n    }\r\n}\r\n\r\n/**\r\n * Test OpenSky API authentication (Debug utility)\r\n * Call this from browser console: testOpenSkyAuth()\r\n */\r\nwindow.testOpenSkyAuth = async function () {\r\n    console.log('üîç Testing OpenSky API Authentication...');\r\n    console.log('---');\r\n\r\n    const url = 'https://opensky-network.org/api/states/all?lamin=40&lamax=41&lomin=-74&lomax=-73';\r\n\r\n    try {\r\n        const response = await fetch(url, {\r\n            headers: OPENSKY_USERNAME ? {\r\n                'Authorization': 'Basic ' + btoa(`${OPENSKY_USERNAME}:${OPENSKY_PASSWORD}`)\r\n            } : {}\r\n        });\r\n\r\n        const rateLimitRemaining = response.headers.get('X-Rate-Limit-Remaining');\r\n        const rateLimitReset = response.headers.get('X-Rate-Limit-Reset');\r\n\r\n        console.log('‚úÖ API Connection Status:');\r\n        console.log(`   Status: ${response.status} ${response.statusText}`);\r\n        console.log(`   Authenticated: ${OPENSKY_USERNAME ? '‚úÖ Yes' : '‚ùå No (Anonymous)'}`);\r\n        console.log(`   Username: ${OPENSKY_USERNAME || '(none)'}`);\r\n        console.log(`   Rate Limit Remaining: ${rateLimitRemaining || 'Unknown'}`);\r\n        console.log(`   Rate Limit Reset: ${rateLimitReset ? new Date(rateLimitReset * 1000).toLocaleString() : 'Unknown'}`);\r\n\r\n        if (response.ok) {\r\n            const data = await response.json();\r\n            console.log(`   Aircraft in test area: ${data.states?.length || 0}`);\r\n            console.log('---');\r\n            console.log('‚úÖ API is working correctly!');\r\n        } else {\r\n            console.log('---');\r\n            console.log(`‚ùå API Error: ${response.status}`);\r\n            if (response.status === 401) {\r\n                console.log('   ‚Üí Check your username and password in .env file');\r\n            } else if (response.status === 429) {\r\n                console.log('   ‚Üí Rate limit exceeded. Wait or reduce request frequency.');\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.log('---');\r\n        console.log('‚ùå Connection Error:', error.message);\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * Filter and prioritize aircraft for display\r\n */\r\nfunction filterAircraftForDisplay(aircraftData) {\r\n    // Filter out aircraft without position or on ground\r\n    const validAircraft = aircraftData.filter(state => {\r\n        const [, , , , , longitude, latitude, baro_altitude, on_ground, , , , , geo_altitude] = state;\r\n        const altitude = baro_altitude || geo_altitude || 0;\r\n\r\n        // Basic validity check\r\n        if (!longitude || !latitude || on_ground) return false;\r\n\r\n        // Search Filter\r\n        if (app.searchQuery) {\r\n            const query = app.searchQuery;\r\n            const callsign = state[1]?.trim().toUpperCase() || '';\r\n            const icao = state[0]?.toUpperCase() || '';\r\n            const origin = state[2]?.toUpperCase() || '';\r\n\r\n            if (!callsign.includes(query) && !icao.includes(query) && !origin.includes(query)) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    });\r\n\r\n    // If under the limit, return all\r\n    if (validAircraft.length <= MAX_AIRCRAFT_DISPLAY) {\r\n        return validAircraft;\r\n    }\r\n\r\n    // Prioritize by altitude (higher altitude aircraft are more visible and interesting)\r\n    const sorted = validAircraft.sort((a, b) => {\r\n        const altA = a[7] || a[13] || 0; // baro_altitude or geo_altitude\r\n        const altB = b[7] || b[13] || 0;\r\n        return altB - altA; // Higher altitude first\r\n    });\r\n\r\n    console.log(`‚ö†Ô∏è Limiting display: ${validAircraft.length} aircraft available, showing top ${MAX_AIRCRAFT_DISPLAY} by altitude`);\r\n    return sorted.slice(0, MAX_AIRCRAFT_DISPLAY);\r\n}\r\n\r\n/**\r\n * Calculate predicted position based on velocity and heading\r\n * @param {number} longitude - Current longitude in degrees\r\n * @param {number} latitude - Current latitude in degrees\r\n * @param {number} altitude - Current altitude in meters\r\n * @param {number} velocity - Velocity in m/s\r\n * @param {number} heading - True track heading in degrees\r\n * @param {number} verticalRate - Vertical rate in m/s (optional)\r\n * @param {number} seconds - Number of seconds to predict ahead\r\n * @returns {object} Predicted position {longitude, latitude, altitude}\r\n */\r\nfunction predictPosition(longitude, latitude, altitude, velocity, heading, verticalRate, seconds) {\r\n    // If no velocity data, return current position\r\n    if (!velocity || velocity === 0) {\r\n        return { longitude, latitude, altitude };\r\n    }\r\n\r\n    // Earth's radius in meters\r\n    const EARTH_RADIUS = 6371000;\r\n\r\n    // Convert heading to radians (0¬∞ = North, 90¬∞ = East)\r\n    const headingRad = Cesium.Math.toRadians(heading);\r\n\r\n    // Calculate distance traveled in meters\r\n    const distance = velocity * seconds;\r\n\r\n    // Calculate change in latitude and longitude\r\n    // Œîlat = distance * cos(heading) / earth_radius (in radians)\r\n    // Œîlon = distance * sin(heading) / (earth_radius * cos(lat)) (in radians)\r\n    const latRad = Cesium.Math.toRadians(latitude);\r\n    const deltaLat = (distance * Math.cos(headingRad)) / EARTH_RADIUS;\r\n    const deltaLon = (distance * Math.sin(headingRad)) / (EARTH_RADIUS * Math.cos(latRad));\r\n\r\n    // Convert back to degrees\r\n    const newLatitude = latitude + Cesium.Math.toDegrees(deltaLat);\r\n    const newLongitude = longitude + Cesium.Math.toDegrees(deltaLon);\r\n\r\n    // Calculate altitude change if vertical rate is available\r\n    const newAltitude = altitude + (verticalRate || 0) * seconds;\r\n\r\n    return {\r\n        longitude: newLongitude,\r\n        latitude: newLatitude,\r\n        altitude: Math.max(0, newAltitude) // Ensure altitude doesn't go negative\r\n    };\r\n}\r\n\r\n/**\r\n * Create or update position property with interpolation\r\n * @param {object} entity - Cesium entity\r\n * @param {number} longitude - Current longitude\r\n * @param {number} latitude - Current latitude\r\n * @param {number} altitude - Current altitude in meters\r\n * @param {number} velocity - Velocity in m/s\r\n * @param {number} heading - Heading in degrees\r\n * @param {number} verticalRate - Vertical rate in m/s\r\n * @returns {SampledPositionProperty} Position property with interpolation\r\n */\r\nfunction createInterpolatedPosition(entity, longitude, latitude, altitude, velocity, heading, verticalRate) {\r\n    // Use viewer clock time to ensure synchronization with the scene\r\n    const currentTime = app.viewer ? app.viewer.clock.currentTime : Cesium.JulianDate.now();\r\n    const futureTime = Cesium.JulianDate.addSeconds(currentTime, 60, new Cesium.JulianDate()); // Predict 60s ahead\r\n\r\n    // Create or get existing SampledPositionProperty\r\n    let positionProperty;\r\n    let startPosition;\r\n\r\n    if (entity && entity.position instanceof Cesium.SampledPositionProperty) {\r\n        positionProperty = entity.position;\r\n\r\n        // VISUAL CONTINUITY: Start from where the aircraft *currently looks like it is*\r\n        // This prevents the \"snap\" effect when the API position differs from the predicted position\r\n        const visualPosition = entity.position.getValue(currentTime);\r\n        if (visualPosition) {\r\n            startPosition = visualPosition;\r\n        } else {\r\n            // Fallback if no visual position is available (shouldn't happen often for existing entities)\r\n            startPosition = Cesium.Cartesian3.fromDegrees(longitude, latitude, altitude);\r\n        }\r\n\r\n        // Cleanup: Remove samples in the overlapping future window to prevent conflicts\r\n        // We are redefining the path from currentTime onwards\r\n        positionProperty.removeSamples(\r\n            new Cesium.TimeInterval({\r\n                start: currentTime,\r\n                stop: Cesium.JulianDate.addSeconds(currentTime, 3600, new Cesium.JulianDate())\r\n            })\r\n        );\r\n\r\n        // Cleanup: Remove very old samples to save memory (older than 300s)\r\n        positionProperty.removeSamples(\r\n            new Cesium.TimeInterval({\r\n                start: Cesium.JulianDate.addSeconds(currentTime, -3600, new Cesium.JulianDate()),\r\n                stop: Cesium.JulianDate.addSeconds(currentTime, -300, new Cesium.JulianDate())\r\n            })\r\n        );\r\n    } else {\r\n        positionProperty = new Cesium.SampledPositionProperty();\r\n        // Use Hermite polynomial approximation for smoother curved paths\r\n        positionProperty.setInterpolationOptions({\r\n            interpolationDegree: 2,\r\n            interpolationAlgorithm: Cesium.HermitePolynomialApproximation\r\n        });\r\n        startPosition = Cesium.Cartesian3.fromDegrees(longitude, latitude, altitude);\r\n    }\r\n\r\n    // Add the start point (continuity point)\r\n    positionProperty.addSample(currentTime, startPosition);\r\n\r\n    // Calculate and add predicted future position\r\n    const predicted = predictPosition(\r\n        longitude, latitude, altitude,\r\n        velocity, heading, verticalRate,\r\n        60 // Predict 60 seconds ahead to ensure overlap\r\n    );\r\n    const futurePosition = Cesium.Cartesian3.fromDegrees(\r\n        predicted.longitude,\r\n        predicted.latitude,\r\n        predicted.altitude\r\n    );\r\n    positionProperty.addSample(futureTime, futurePosition);\r\n\r\n    return positionProperty;\r\n}\r\n\r\n/**\r\n * Update aircraft visualization\r\n */\r\nfunction updateAircraftDisplay(aircraftData) {\r\n    if (!app.viewer) return;\r\n\r\n    // Use cached data if not provided (for filter updates)\r\n    if (!aircraftData) {\r\n        aircraftData = app.lastAircraftData;\r\n    } else {\r\n        app.lastAircraftData = aircraftData;\r\n    }\r\n\r\n    const entities = app.viewer.entities;\r\n    const currentIds = new Set();\r\n\r\n    // Filter aircraft to display limit\r\n    const displayAircraft = filterAircraftForDisplay(aircraftData);\r\n\r\n    displayAircraft.forEach(state => {\r\n        const [\r\n            icao24, callsign, origin_country, time_position, last_contact,\r\n            longitude, latitude, baro_altitude, on_ground, velocity,\r\n            true_track, vertical_rate, sensors, geo_altitude, squawk, spi, position_source\r\n        ] = state;\r\n\r\n        const id = icao24; // Main ID (Visual Model)\r\n        const trackId = `${id}-track`; // Secondary ID (Path/Physics)\r\n\r\n        currentIds.add(id);\r\n        currentIds.add(trackId);\r\n\r\n        const altitude = (baro_altitude || geo_altitude || 0);\r\n        const velocityMs = (velocity || 0) * 0.51444;\r\n        const verticalRateMs = (vertical_rate || 0); // OpenSky vertical_rate is already in m/s\r\n        const heading = true_track || 0;\r\n\r\n        // --- 1. Track Entity (Physics/Path) ---\r\n        // Handles interpolation and the trailing path. Invisible.\r\n        let trackEntity = entities.getById(trackId);\r\n        let visualEntity = entities.getById(id);\r\n\r\n        let positionProperty;\r\n\r\n        if (!trackEntity) {\r\n            positionProperty = createInterpolatedPosition(\r\n                null, longitude, latitude, altitude, velocityMs, heading, verticalRateMs\r\n            );\r\n\r\n            trackEntity = entities.add({\r\n                id: trackId,\r\n                position: positionProperty,\r\n                orientation: new Cesium.VelocityOrientationProperty(positionProperty),\r\n                point: {\r\n                    pixelSize: 1,\r\n                    color: Cesium.Color.RED.withAlpha(0.0),\r\n                    outlineWidth: 0\r\n                },\r\n                // Trail on track entity (has proper SampledPositionProperty)\r\n                path: {\r\n                    leadTime: 0,\r\n                    trailTime: 300,\r\n                    width: 10,\r\n                    material: Cesium.Color.YELLOW.withAlpha(0.25),\r\n                    show: new Cesium.CallbackProperty(() => app.filters.showTraces, false)\r\n                },\r\n                // Drop line to ground for depth perception\r\n                polyline: {\r\n                    positions: new Cesium.CallbackProperty((time, result) => {\r\n                        const pos = trackEntity.position.getValue(time);\r\n                        if (!pos) return result;\r\n                        const carto = Cesium.Cartographic.fromCartesian(pos);\r\n                        const groundPos = Cesium.Cartesian3.fromDegrees(\r\n                            Cesium.Math.toDegrees(carto.longitude),\r\n                            Cesium.Math.toDegrees(carto.latitude),\r\n                            0\r\n                        );\r\n                        return [pos, groundPos];\r\n                    }, false),\r\n                    width: 1,\r\n                    material: new Cesium.PolylineDashMaterialProperty({\r\n                        color: Cesium.Color.WHITE.withAlpha(0.2),\r\n                        dashLength: 16\r\n                    }),\r\n                    show: new Cesium.CallbackProperty(() => {\r\n                        // Show if traces are enabled AND (it's selected OR camera is high up)\r\n                        if (!app.filters.showTraces) return false;\r\n                        if (app.selectedAircraft && (app.selectedAircraft.id === id || app.selectedAircraft.id === trackId)) return true;\r\n\r\n                        // Also show in overview mode (height > 50km)\r\n                        return app.viewer.camera.positionCartographic.height > 50000;\r\n                    }, false),\r\n                    distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 1000000)\r\n                }\r\n            });\r\n        } else {\r\n            positionProperty = createInterpolatedPosition(\r\n                trackEntity, longitude, latitude, altitude, velocityMs, heading, verticalRateMs\r\n            );\r\n            if (trackEntity.position !== positionProperty) {\r\n                trackEntity.position = positionProperty;\r\n            }\r\n        }\r\n\r\n        // --- 2. Visual Entity (Model/Interaction) ---\r\n        // This is the MAIN entity the user clicks and sees.\r\n        // It follows the Track Entity with an offset.\r\n\r\n        // OFFSETS REMOVED - Trail should align with aircraft center\r\n        // The visual model and trail now share the same position (no offset)\r\n        // This ensures the trail emanates from the aircraft's actual position\r\n        // FIXED OFFSETS (Aligned via Manual Debug Mode)\r\n        // These are now applied to the MODEL NODES to scale correctly with minimumPixelSize\r\n        const MODEL_OFFSET_X = 55.40;\r\n        const MODEL_OFFSET_Y = -55.00; // Original -114.00 + 59.00 increment\r\n        const MODEL_OFFSET_Z = -10.00;\r\n\r\n        if (!visualEntity) {\r\n            // Create Translation Callback for NodeTransformationProperty\r\n            const translationCallback = new Cesium.CallbackProperty((time, result) => {\r\n                const x = MODEL_OFFSET_X + app.debugOffsets.x;\r\n                const y = MODEL_OFFSET_Y + app.debugOffsets.y;\r\n                const z = MODEL_OFFSET_Z + app.debugOffsets.z;\r\n\r\n                // Reuse result object if available for performance\r\n                if (!result) {\r\n                    return new Cesium.Cartesian3(x, y, z);\r\n                }\r\n                result.x = x;\r\n                result.y = y;\r\n                result.z = z;\r\n                return result;\r\n            }, false);\r\n\r\n            // Create NodeTransformationProperty\r\n            const nodeTransform = new Cesium.NodeTransformationProperty({\r\n                translation: translationCallback\r\n            });\r\n\r\n            // Targets based on debug output\r\n            const transformations = {\r\n                'Sketchfab_model': nodeTransform,\r\n                'ba14754abb1947bba7d9b51a2bc63084.fbx': nodeTransform,\r\n                'RootNode': nodeTransform\r\n            };\r\n\r\n            visualEntity = entities.add({\r\n                id: id,\r\n                // Direct position reference (No World Offset)\r\n                position: trackEntity.position,\r\n                orientation: trackEntity.orientation,\r\n                // Model Definition\r\n                // Model Definition\r\n                model: {\r\n                    uri: `${import.meta.env.BASE_URL}assets/boeing_767-200er.glb`,\r\n                    minimumPixelSize: 32,\r\n                    maximumScale: 200,\r\n                    runAnimations: false,\r\n                    nodeTransformations: transformations,\r\n\r\n                    // Gradual Fading via Scaling (Shrink to zero)\r\n                    scale: new Cesium.CallbackProperty((time, result) => {\r\n                        const cameraPos = app.viewer.camera.positionWC;\r\n                        // fast distance check using entity position\r\n                        const entityPos = trackEntity.position.getValue(time);\r\n                        if (!entityPos) return 1.0;\r\n\r\n                        const dist = Cesium.Cartesian3.distance(cameraPos, entityPos);\r\n\r\n                        // Fade range: start 50km, end 500km (User requested 500km)\r\n                        const near = 50000.0;\r\n                        const far = 500000.0;\r\n\r\n                        if (dist < near) {\r\n                            return 1.0;\r\n                        } else if (dist > far) {\r\n                            return 0.0; // Invisible\r\n                        } else {\r\n                            // Valid range: interpolate 1.0 -> 0.0\r\n                            return 1.0 - ((dist - near) / (far - near));\r\n                        }\r\n                    }, false),\r\n\r\n                    distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 500000)\r\n                },\r\n                // Label\r\n                label: {\r\n                    text: callsign?.trim() || icao24,\r\n                    font: 'bold 14px \"JetBrains Mono\", monospace',\r\n                    fillColor: Cesium.Color.fromCssColorString('#00ff41'),\r\n                    outlineColor: Cesium.Color.BLACK,\r\n                    outlineWidth: 2,\r\n                    style: Cesium.LabelStyle.FILL_AND_OUTLINE,\r\n                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,\r\n                    pixelOffset: new Cesium.Cartesian2(0, -20),\r\n                    distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 500000),\r\n                    // Gradual Fading for Labels provided by Cesium\r\n                    translucencyByDistance: new Cesium.NearFarScalar(50000, 1.0, 500000, 0.0),\r\n                    disableDepthTestDistance: Number.POSITIVE_INFINITY\r\n                },\r\n                // Properties\r\n                properties: {\r\n                    callsign: callsign?.trim() || 'N/A',\r\n                    altitude: Math.round(baro_altitude || geo_altitude || 0),\r\n                    velocity: Math.round(velocity || 0),\r\n                    heading: Math.round(heading),\r\n                    origin: origin_country,\r\n                    type: 'aircraft'\r\n                }\r\n            });\r\n        } else {\r\n            // Update Properties\r\n            visualEntity.label.text = callsign?.trim() || icao24;\r\n            visualEntity.properties.altitude = Math.round(baro_altitude || geo_altitude || 0);\r\n            visualEntity.properties.velocity = Math.round(velocity || 0);\r\n            visualEntity.properties.heading = Math.round(heading);\r\n\r\n            // Ensure orientation matches\r\n            if (visualEntity.orientation !== trackEntity.orientation) {\r\n                visualEntity.orientation = trackEntity.orientation;\r\n            }\r\n\r\n            // Sync position if needed (Direct reference)\r\n            if (visualEntity.position !== trackEntity.position) {\r\n                visualEntity.position = trackEntity.position;\r\n            }\r\n        }\r\n    });\r\n\r\n    // Remove aircraft that are no longer in the data\r\n    const allEntities = entities.values;\r\n    for (let i = allEntities.length - 1; i >= 0; i--) {\r\n        const entity = allEntities[i];\r\n\r\n        // Skip non-aircraft entities (like airports and the selection bracket)\r\n        if (entity.id === 'selection-bracket') {\r\n            continue;\r\n        }\r\n\r\n        if (entity.properties && entity.properties.type && entity.properties.type.getValue() === 'airport') {\r\n            continue;\r\n        }\r\n\r\n        if (!currentIds.has(entity.id)) {\r\n            entities.remove(entity);\r\n        }\r\n    }\r\n\r\n    const totalAvailable = aircraftData.filter(state => {\r\n        const [, , , , , longitude, latitude, , on_ground] = state;\r\n        return longitude && latitude && !on_ground;\r\n    }).length;\r\n\r\n    if (totalAvailable > MAX_AIRCRAFT_DISPLAY) {\r\n        updateStatus(`TRACKING ${currentIds.size}/${totalAvailable} AIRCRAFT`);\r\n    } else {\r\n        updateStatus(`TRACKING ${currentIds.size} AIRCRAFT`);\r\n    }\r\n\r\n    // Force a frame render\r\n    app.viewer.scene.requestRender();\r\n}\r\n\r\n/**\r\n * Update camera position based on mode\r\n */\r\nfunction updateCamera() {\r\n    if (!app.viewer || !app.trackedEntity || app.followMode === 'NONE') return;\r\n\r\n    const entity = app.trackedEntity;\r\n    // Check if the entity still exists in the collection\r\n    if (!app.viewer.entities.contains(entity)) {\r\n        stopCameraModes();\r\n        return;\r\n    }\r\n\r\n    const position = entity.position.getValue(app.viewer.clock.currentTime);\r\n\r\n    // If entity has no position (e.g. lost signal), stop tracking\r\n    if (!position) {\r\n        return;\r\n    }\r\n\r\n    if (app.followMode === 'TRACK') {\r\n        // Cesium handles tracking automatically via viewer.trackedEntity\r\n        // We just ensure it's set (it might be unset if user pans away or we switch modes)\r\n        if (app.viewer.trackedEntity !== entity) {\r\n            app.viewer.trackedEntity = entity;\r\n        }\r\n    } else if (app.followMode === 'FOLLOW') {\r\n        // Custom chase camera\r\n\r\n        // Get heading\r\n        let heading = 0;\r\n        const orientation = entity.orientation ? entity.orientation.getValue(app.viewer.clock.currentTime) : null;\r\n\r\n        if (orientation) {\r\n            heading = Cesium.HeadingPitchRoll.fromQuaternion(orientation).heading;\r\n        } else {\r\n            heading = Cesium.Math.toRadians(entity.properties.heading.getValue() || 0);\r\n        }\r\n\r\n        const distance = 500; // meters behind\r\n\r\n        if (app.viewer.trackedEntity) {\r\n            app.viewer.trackedEntity = undefined;\r\n        }\r\n\r\n        const headingPitchRange = new Cesium.HeadingPitchRange(\r\n            heading,\r\n            Cesium.Math.toRadians(-20), // Slight look down\r\n            distance\r\n        );\r\n\r\n        app.viewer.camera.lookAt(position, headingPitchRange);\r\n\r\n    } else if (app.followMode === 'GROUND') {\r\n        const targetPos = entity.position.getValue(app.viewer.clock.currentTime);\r\n        if (!targetPos || !app.groundCameraPos) return;\r\n\r\n        // Calculate direction from ground to aircraft\r\n        const direction = Cesium.Cartesian3.normalize(\r\n            Cesium.Cartesian3.subtract(targetPos, app.groundCameraPos, new Cesium.Cartesian3()),\r\n            new Cesium.Cartesian3()\r\n        );\r\n\r\n        // Update camera position and orientation\r\n        app.viewer.camera.setView({\r\n            destination: app.groundCameraPos,\r\n            orientation: {\r\n                direction: direction,\r\n                up: Cesium.Cartesian3.normalize(app.groundCameraPos, new Cesium.Cartesian3())\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Stop active camera modes\r\n */\r\nfunction stopCameraModes() {\r\n    app.followMode = 'NONE';\r\n    app.trackedEntity = null;\r\n    app.viewer.trackedEntity = undefined;\r\n\r\n    // Release camera from lookAt\r\n    app.viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\r\n}\r\n\r\n/**\r\n * Start tracking an entity (Lock view)\r\n */\r\nfunction startTracking(entity) {\r\n    if (!entity) return;\r\n\r\n    // If already following, we need to release lookAt first\r\n    if (app.followMode === 'FOLLOW') {\r\n        app.viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\r\n    }\r\n\r\n    app.trackedEntity = entity;\r\n    app.followMode = 'TRACK';\r\n    app.viewer.trackedEntity = entity;\r\n    updateStatus(`TRACKING ${entity.properties.callsign || entity.id}`);\r\n    setTraceVisibility(true);\r\n}\r\n\r\n/**\r\n * Start following an entity (Chase view)\r\n */\r\nfunction startFollowing(entity) {\r\n    if (!entity) return;\r\n    app.trackedEntity = entity;\r\n    app.followMode = 'FOLLOW';\r\n    // Native tracking disabled in update loop to allow custom lookAt\r\n    updateStatus(`FOLLOWING ${entity.properties.callsign || entity.id}`);\r\n    setTraceVisibility(true);\r\n}\r\n\r\n/**\r\n * Start ground view (Look up from ground)\r\n */\r\nfunction startGroundView(entity) {\r\n    if (!entity) return;\r\n\r\n    const position = entity.position.getValue(app.viewer.clock.currentTime);\r\n    if (!position) return;\r\n\r\n    const cartographic = Cesium.Cartographic.fromCartesian(position);\r\n\r\n    // Position camera on ground directly below or slightly offset\r\n    const groundPos = Cesium.Cartesian3.fromDegrees(\r\n        Cesium.Math.toDegrees(cartographic.longitude),\r\n        Cesium.Math.toDegrees(cartographic.latitude),\r\n        10 // 10 meters above ground\r\n    );\r\n\r\n    app.trackedEntity = entity;\r\n    app.followMode = 'GROUND';\r\n    app.groundCameraPos = groundPos;\r\n\r\n    // Release from any existing tracking\r\n    app.viewer.trackedEntity = undefined;\r\n    app.viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\r\n\r\n    // Smoothly fly to ground position first\r\n    app.viewer.camera.flyTo({\r\n        destination: groundPos,\r\n        orientation: {\r\n            heading: Cesium.Math.toRadians(0),\r\n            pitch: Cesium.Math.toRadians(45),\r\n            roll: 0.0\r\n        },\r\n        duration: 2\r\n    });\r\n\r\n    updateStatus(`GROUND VIEW: ${entity.properties.callsign || entity.id}`);\r\n}\r\n\r\n/**\r\n * Start cockpit view\r\n */\r\n\r\n\r\n/**\r\n * Update status indicator\r\n */\r\nfunction updateStatus(text, isError = false) {\r\n    const statusText = document.querySelector('.status-text');\r\n    const statusIndicator = document.querySelector('.status-indicator');\r\n\r\n    if (statusText) {\r\n        statusText.textContent = text;\r\n    }\r\n\r\n    if (statusIndicator) {\r\n        statusIndicator.style.background = isError ? '#ff4444' : '#00ff41';\r\n    }\r\n}\r\n\r\n/**\r\n * Setup UI event listeners\r\n */\r\nfunction setupEventListeners() {\r\n    // Search input\r\n    const searchInput = document.getElementById('searchInput');\r\n    searchInput?.addEventListener('input', handleSearch);\r\n\r\n    // Camera controls\r\n    // Overview listener moved to setupEventListeners to consolidate\r\n\r\n    // Close details panel\r\n    document.getElementById('closeDetails')?.addEventListener('click', () => {\r\n        document.getElementById('aircraftDetails')?.classList.add('hidden');\r\n        app.selectedAircraft = null;\r\n        if (app.selectionBracket) app.selectionBracket.show = false;\r\n    });\r\n\r\n    // Aircraft click handler\r\n    const handler = new Cesium.ScreenSpaceEventHandler(app.viewer.scene.canvas);\r\n    handler.setInputAction((click) => {\r\n        // Use drillPick to get all objects at the click position (handling overlapping bracket/aircraft)\r\n        const pickedObjects = app.viewer.scene.drillPick(click.position);\r\n\r\n        if (Cesium.defined(pickedObjects) && pickedObjects.length > 0) {\r\n            // Find the first relevant entity (aircraft or airport)\r\n            // Skip the selection bracket if it's the top item\r\n            let targetEntity = null;\r\n\r\n            for (let i = 0; i < pickedObjects.length; i++) {\r\n                const picked = pickedObjects[i];\r\n                const entityId = (typeof picked.id === 'string') ? picked.id : (picked.id ? picked.id.id : null);\r\n\r\n                if (entityId === 'selection-bracket') {\r\n                    continue; // Skip the bracket itself\r\n                }\r\n\r\n                if (picked.id instanceof Cesium.Entity) {\r\n                    targetEntity = picked.id;\r\n                    break; // Found a valid entity\r\n                }\r\n            }\r\n\r\n            if (targetEntity) {\r\n                showAircraftDetails(targetEntity);\r\n            } else {\r\n                // Clicked only on bracket or something irrelevant? Deselect.\r\n                // Or maybe just do nothing if we clicked bracket? \r\n                // Let's deselect only if we really found nothing relevant in the stack\r\n                // But actually, if we click 'nothing' (sky/ground), drillPick might be empty or contain non-entities.\r\n            }\r\n        } else {\r\n            // Clicked on empty space\r\n            document.getElementById('aircraftDetails')?.classList.add('hidden');\r\n            app.selectedAircraft = null;\r\n            if (app.selectionBracket) app.selectionBracket.show = false;\r\n        }\r\n    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n    // Aircraft Detail Action Buttons\r\n    document.getElementById('detailOverview')?.addEventListener('click', () => {\r\n        stopCameraModes();\r\n        setTraceVisibility(false);\r\n        app.viewer.camera.cancelFlight();\r\n        app.viewer.camera.setView({\r\n            destination: Cesium.Cartesian3.fromDegrees(27.43, 37.04, 200000),\r\n            orientation: {\r\n                heading: 0.0,\r\n                pitch: -Cesium.Math.PI_OVER_TWO,\r\n                roll: 0.0\r\n            }\r\n        });\r\n    });\r\n\r\n    document.getElementById('detailTrack')?.addEventListener('click', () => {\r\n        if (app.selectedAircraft) startTracking(app.selectedAircraft);\r\n    });\r\n\r\n    document.getElementById('detailFollow')?.addEventListener('click', () => {\r\n        if (app.selectedAircraft) startFollowing(app.selectedAircraft);\r\n    });\r\n\r\n    document.getElementById('detailGround')?.addEventListener('click', () => {\r\n        if (app.selectedAircraft) startGroundView(app.selectedAircraft);\r\n    });\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // Debug Panel - Close Button\r\n    document.getElementById('closeDebug')?.addEventListener('click', () => {\r\n        app.debugMode = false;\r\n        document.getElementById('debugPanel')?.classList.add('hidden');\r\n    });\r\n\r\n    // Debug Panel - Reset Offsets\r\n    document.getElementById('resetOffsets')?.addEventListener('click', () => {\r\n        app.debugOffsets.x = 0.0;\r\n        app.debugOffsets.y = 0.0;\r\n        app.debugOffsets.z = 0.0;\r\n        updateDebugUI();\r\n        console.log('üîß Offsets reset to zero');\r\n    });\r\n\r\n    // Debug Panel - Copy Offsets\r\n    document.getElementById('copyOffsets')?.addEventListener('click', () => {\r\n        const offsetText = `// Aircraft Model Offsets\\nconst MODEL_OFFSET_X = ${app.debugOffsets.x.toFixed(2)}; // Left/Right\\nconst MODEL_OFFSET_Y = ${app.debugOffsets.y.toFixed(2)}; // Forward/Backward\\nconst MODEL_OFFSET_Z = ${app.debugOffsets.z.toFixed(2)}; // Up/Down`;\r\n\r\n        navigator.clipboard.writeText(offsetText).then(() => {\r\n            console.log('‚úÖ Offset values copied to clipboard!');\r\n            console.log(offsetText);\r\n            alert('Offset values copied to clipboard!');\r\n        }).catch(err => {\r\n            console.error('‚ùå Failed to copy:', err);\r\n        });\r\n    });\r\n\r\n    // Debug Panel - Apply Offsets to All\r\n    document.getElementById('applyOffsets')?.addEventListener('click', () => {\r\n        console.log('‚úÖ Offsets saved and will be applied to all aircraft:', app.debugOffsets);\r\n        alert(`Offsets applied: X=${app.debugOffsets.x.toFixed(2)}m, Y=${app.debugOffsets.y.toFixed(2)}m, Z=${app.debugOffsets.z.toFixed(2)}m`);\r\n        // The offsets are already being used in the position calculation, so just confirm\r\n    });\r\n\r\n    // Keyboard Controls for Debug Mode\r\n    document.addEventListener('keydown', (event) => {\r\n        const controlKeys = ['w', 'a', 's', 'd', 'q', 'e', 'W', 'A', 'S', 'D', 'Q', 'E'];\r\n\r\n        // Toggle Debug Mode with CTRL+SHIFT+ALT+D\r\n        if (event.ctrlKey && event.shiftKey && event.altKey && event.key.toLowerCase() === 'd') {\r\n            event.preventDefault();\r\n            app.debugMode = !app.debugMode;\r\n            const debugPanel = document.getElementById('debugPanel');\r\n            if (app.debugMode) {\r\n                debugPanel?.classList.remove('hidden');\r\n                console.log('üîß Debug Mode ENABLED - Use WASDQE keys to adjust aircraft position');\r\n            } else {\r\n                debugPanel?.classList.add('hidden');\r\n                console.log('üîß Debug Mode DISABLED');\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (!app.debugMode || !app.selectedAircraft) return;\r\n\r\n        if (controlKeys.includes(event.key)) {\r\n            event.preventDefault();\r\n        }\r\n\r\n        // Determine adjustment magnitude\r\n        let step = 1.0; // Default: 1 meter\r\n        if (event.shiftKey) step = 0.1; // Fine: 0.1 meters\r\n        if (event.ctrlKey) step = 10.0; // Coarse: 10 meters\r\n\r\n        // Apply adjustments based on key\r\n        switch (event.key.toLowerCase()) {\r\n            case 'a': // Move Left\r\n                app.debugOffsets.x -= step;\r\n                break;\r\n            case 'd': // Move Right\r\n                app.debugOffsets.x += step;\r\n                break;\r\n            case 'w': // Move Forward\r\n                app.debugOffsets.y += step;\r\n                break;\r\n            case 's': // Move Backward\r\n                app.debugOffsets.y -= step;\r\n                break;\r\n            case 'q': // Move Down\r\n                app.debugOffsets.z -= step;\r\n                break;\r\n            case 'e': // Move Up\r\n                app.debugOffsets.z += step;\r\n                break;\r\n            default:\r\n                return; // Not a control key, don't update UI\r\n        }\r\n\r\n        updateDebugUI();\r\n        console.log(`üîß Offset adjusted: X=${app.debugOffsets.x.toFixed(2)}, Y=${app.debugOffsets.y.toFixed(2)}, Z=${app.debugOffsets.z.toFixed(2)}`);\r\n    });\r\n\r\n    setupFilterListeners();\r\n}\r\n\r\n/**\r\n * Update Debug UI with current offset values\r\n */\r\nfunction updateDebugUI() {\r\n    document.getElementById('debugOffsetX').textContent = `${app.debugOffsets.x.toFixed(2)} m`;\r\n    document.getElementById('debugOffsetY').textContent = `${app.debugOffsets.y.toFixed(2)} m`;\r\n    document.getElementById('debugOffsetZ').textContent = `${app.debugOffsets.z.toFixed(2)} m`;\r\n\r\n    setupFilterListeners();\r\n\r\n}\r\n\r\n/**\r\n * Set trace visibility\r\n * @param {boolean} visible \r\n */\r\nfunction setTraceVisibility(visible) {\r\n    app.filters.showTraces = visible;\r\n    const toggleTraces = document.getElementById('toggleTraces');\r\n    if (toggleTraces) {\r\n        toggleTraces.classList.toggle('active', visible);\r\n    }\r\n    app.viewer?.scene?.requestRender();\r\n}\r\n\r\n/**\r\n * Setup Filter UI listeners\r\n */\r\nfunction setupFilterListeners() {\r\n    const toggleAirports = document.getElementById('toggleAirports');\r\n    const toggleTraces = document.getElementById('toggleTraces');\r\n\r\n    toggleAirports?.addEventListener('click', () => {\r\n        app.filters.showAirports = !app.filters.showAirports;\r\n        toggleAirports.classList.toggle('active', app.filters.showAirports);\r\n        renderAirports();\r\n\r\n        // Toggle Runway/Taxiway Overlay\r\n        const runwayDS = app.viewer.dataSources.getByName('airport-surfaces');\r\n        if (runwayDS && runwayDS.length > 0) {\r\n            runwayDS[0].show = app.filters.showAirports;\r\n        }\r\n    });\r\n\r\n    toggleTraces?.addEventListener('click', () => {\r\n        app.filters.showTraces = !app.filters.showTraces;\r\n        toggleTraces.classList.toggle('active', app.filters.showTraces);\r\n        // The CallbackProperty in entity.path.show will automatically pick this up\r\n        // but we might need to request a render\r\n        app.viewer.scene.requestRender();\r\n    });\r\n}\r\n\r\n/**\r\n * Handle search input\r\n */\r\nfunction handleSearch(event) {\r\n    const query = event.target.value.trim().toUpperCase();\r\n    app.searchQuery = query;\r\n\r\n    // Clear existing timeout\r\n    if (app.searchTimeout) {\r\n        clearTimeout(app.searchTimeout);\r\n    }\r\n\r\n    if (!query) {\r\n        renderSearchResults([]);\r\n        updateAircraftDisplay();\r\n        return;\r\n    }\r\n\r\n    // Debounce search (300ms)\r\n    app.searchTimeout = setTimeout(async () => {\r\n        console.log('Searching for:', query);\r\n        const results = await performSearch(query);\r\n        renderSearchResults(results);\r\n        updateAircraftDisplay();\r\n    }, 300);\r\n}\r\n\r\n/**\r\n * Perform search for cities, airports, and flights\r\n */\r\nasync function performSearch(query) {\r\n    if (!query || query.length < 2) return [];\r\n\r\n    const results = [];\r\n\r\n    // 1. Search Airports\r\n    const airportMatches = AIRPORTS.filter(a =>\r\n        a.name.toUpperCase().includes(query) ||\r\n        a.icao.toUpperCase().includes(query)\r\n    );\r\n    airportMatches.forEach(a => results.push({\r\n        type: 'AIRPORT',\r\n        label: `${a.icao} - ${a.name}`,\r\n        data: a,\r\n        id: `airport-${a.icao}`\r\n    }));\r\n\r\n    // 2. Search Flights (Currently tracked on map)\r\n    const entities = app.viewer.entities.values;\r\n    const aircraftMatches = entities.filter(e =>\r\n        e.properties && e.properties.type && e.properties.type.getValue() === 'aircraft' &&\r\n        (e.properties.callsign.getValue().toUpperCase().includes(query) || e.id.toUpperCase().includes(query))\r\n    );\r\n    aircraftMatches.forEach(e => results.push({\r\n        type: 'FLIGHT',\r\n        label: `${e.properties.callsign.getValue()} (${e.id})`,\r\n        data: e,\r\n        id: e.id\r\n    }));\r\n\r\n    // 3. Search Cities/Locations (via Geocoder)\r\n    try {\r\n        const geoResults = await app.geocoder.geocode(query);\r\n        if (geoResults && geoResults.length > 0) {\r\n            geoResults.forEach(res => results.push({\r\n                type: 'CITY',\r\n                label: res.displayName,\r\n                data: res,\r\n                id: `geo-${res.displayName}`\r\n            }));\r\n        }\r\n    } catch (error) {\r\n        console.error('Geocoder error:', error);\r\n    }\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * Render search results dropdown\r\n */\r\nfunction renderSearchResults(results) {\r\n    const resultsContainer = document.getElementById('searchResults');\r\n    if (!resultsContainer) return;\r\n\r\n    if (results.length === 0) {\r\n        resultsContainer.innerHTML = '';\r\n        resultsContainer.style.display = 'none';\r\n        return;\r\n    }\r\n\r\n    resultsContainer.innerHTML = results.map(res => `\r\n        <div class=\"search-result-item\" data-id=\"${res.id}\">\r\n            <span class=\"result-type\">[${res.type}]</span>\r\n            <span class=\"result-label\">${res.label}</span>\r\n        </div>\r\n    `).join('');\r\n\r\n    resultsContainer.style.display = 'block';\r\n\r\n    // Add click listeners to results\r\n    resultsContainer.querySelectorAll('.search-result-item').forEach((item, index) => {\r\n        item.addEventListener('click', () => {\r\n            selectSearchResult(results[index]);\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Handle selection of a search result\r\n */\r\nfunction selectSearchResult(result) {\r\n    const { type, data, id } = result;\r\n    console.log('Selected search result:', result);\r\n\r\n    // Clear search\r\n    const searchInput = document.getElementById('searchInput');\r\n    if (searchInput) searchInput.value = '';\r\n    renderSearchResults([]);\r\n    app.searchQuery = '';\r\n\r\n    if (type === 'CITY') {\r\n        app.viewer.camera.flyTo({\r\n            destination: data.destination,\r\n            duration: 3\r\n        });\r\n        updateStatus(`VIEWING: ${data.displayName.toUpperCase()}`);\r\n    } else if (type === 'AIRPORT') {\r\n        const entity = app.viewer.entities.getById(id);\r\n        if (entity) {\r\n            app.viewer.flyTo(entity, {\r\n                offset: new Cesium.HeadingPitchRange(0, Cesium.Math.toRadians(-45), 25000),\r\n                duration: 3\r\n            });\r\n            showAircraftDetails(entity);\r\n        } else {\r\n            // Airport might not be in the collection or hidden\r\n            app.viewer.camera.flyTo({\r\n                destination: Cesium.Cartesian3.fromDegrees(data.lon, data.lat, 25000),\r\n                duration: 3\r\n            });\r\n        }\r\n    } else if (type === 'FLIGHT') {\r\n        const entity = app.viewer.entities.getById(id);\r\n        if (entity) {\r\n            app.viewer.camera.flyTo({\r\n                destination: entity.position.getValue(app.viewer.clock.currentTime),\r\n                offset: new Cesium.HeadingPitchRange(0, Cesium.Math.toRadians(-45), 5000),\r\n                duration: 3\r\n            });\r\n            showAircraftDetails(entity);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Get airliner name from callsign\r\n */\r\n/**\r\n * Get airliner name from callsign\r\n */\r\nfunction getAirlinerFromCallsign(callsign) {\r\n    if (!callsign) return 'GENERAL AVIATION';\r\n    const code = callsign.substring(0, 3).trim();\r\n    return ICAO_AIRLINES[code]?.name || 'PRIVATE/CHARTER';\r\n}\r\n\r\n/**\r\n * Get IATA flight number from ICAO callsign\r\n * e.g., THY123 -> TK 123\r\n */\r\nfunction getFlightNumberFromCallsign(callsign) {\r\n    if (!callsign) return '‚Äî';\r\n\r\n    // Extract 3-letter ICAO code\r\n    const icao = callsign.substring(0, 3).toUpperCase();\r\n\r\n    // Check if we have a mapping\r\n    if (ICAO_AIRLINES[icao]) {\r\n        const iata = ICAO_AIRLINES[icao].iata;\r\n        // Extract the flight number part (everything after the first 3 chars)\r\n        // Remove leading zeros for cleaner look (e.g. 009 -> 9)\r\n        let number = callsign.substring(3).trim();\r\n        number = number.replace(/^0+/, '');\r\n\r\n        return `${iata} ${number}`;\r\n    }\r\n\r\n    // Use fallback regex to separate letters and numbers if unknown airline\r\n    const match = callsign.match(/^([A-Z]+)(\\d+.*)$/);\r\n    if (match) {\r\n        return `${match[1]} ${match[2]}`;\r\n    }\r\n\r\n    return callsign;\r\n}\r\n\r\n/**\r\n * Show aircraft details panel\r\n */\r\nfunction showAircraftDetails(entity) {\r\n    app.selectedAircraft = entity;\r\n\r\n    // Show selection bracket\r\n    if (app.selectionBracket) {\r\n        app.selectionBracket.position = entity.position;\r\n        app.selectionBracket.show = true;\r\n    }\r\n\r\n    const panel = document.getElementById('aircraftDetails');\r\n    panel?.classList.remove('hidden');\r\n\r\n    const isAirport = entity.properties && entity.properties.type && entity.properties.type.getValue() === 'airport';\r\n\r\n    // UI Elements\r\n    const titleEl = document.querySelector('.panel-title');\r\n    const labels = document.querySelectorAll('.data-label');\r\n    const values = document.querySelectorAll('.data-value');\r\n\r\n    // Mappings for easier access\r\n    const ui = {\r\n        airliner: document.getElementById('detailAirliner'),\r\n        flightNum: document.getElementById('detailFlightNum'),\r\n        callsign: document.getElementById('detailCallsign'),\r\n        altitude: document.getElementById('detailAltitude'),\r\n        velocity: document.getElementById('detailVelocity'),\r\n        heading: document.getElementById('detailHeading'),\r\n        origin: document.getElementById('detailOrigin')\r\n    };\r\n\r\n    if (isAirport) {\r\n        // Airport Mode\r\n        titleEl.textContent = 'AIRPORT DATA';\r\n\r\n        if (ui.airliner) ui.airliner.parentElement.style.display = 'none';\r\n        if (ui.flightNum) ui.flightNum.parentElement.style.display = 'none';\r\n\r\n        labels[1].textContent = 'NAME:';         // Callsign (Index 1) -> NAME\r\n        ui.callsign.textContent = entity.properties.name.getValue();\r\n\r\n        labels[3].textContent = 'ALTITUDE:';     // Altitude (Index 3) -> ALTITUDE\r\n        const airportPos = entity.position.getValue(app.viewer.clock.currentTime);\r\n        const cartographic = Cesium.Cartographic.fromCartesian(airportPos);\r\n        ui.altitude.textContent = `${Math.round(cartographic.height)} M`;\r\n\r\n        labels[4].textContent = 'ICAO:';         // Velocity (Index 4) -> ICAO\r\n        ui.velocity.textContent = entity.properties.icao.getValue();\r\n\r\n        // Get lat/lon from cartographic\r\n        labels[5].textContent = 'LAT:';          // Heading (Index 5) -> LAT\r\n        ui.heading.textContent = Cesium.Math.toDegrees(cartographic.latitude).toFixed(4);\r\n\r\n        labels[6].textContent = 'LON:';          // Origin (Index 6) -> LON\r\n        ui.origin.textContent = Cesium.Math.toDegrees(cartographic.longitude).toFixed(4);\r\n\r\n        // Hide Follow/Ground buttons\r\n        document.getElementById('detailFollow').style.display = 'none';\r\n        document.getElementById('detailGround').style.display = 'none';\r\n\r\n    } else {\r\n        // Aircraft Mode\r\n        titleEl.textContent = 'AIRCRAFT DATA';\r\n\r\n        // Show all rows\r\n        Object.values(ui).forEach(el => {\r\n            if (el) el.parentElement.style.display = 'flex';\r\n        });\r\n\r\n        // 1. Clear Fields First (Prevent Stale Data)\r\n        ui.airliner.textContent = '...';\r\n        ui.flightNum.textContent = '...';\r\n        ui.callsign.textContent = '...';\r\n        ui.altitude.textContent = '...';\r\n        ui.velocity.textContent = '...';\r\n        ui.heading.textContent = '...';\r\n        ui.origin.textContent = '...';\r\n\r\n        // 2. Populate Fresh Data\r\n        const callsign = entity.properties.callsign.getValue() || 'N/A';\r\n        ui.airliner.textContent = getAirlinerFromCallsign(callsign);\r\n        ui.flightNum.textContent = getFlightNumberFromCallsign(callsign);\r\n        ui.callsign.textContent = callsign;\r\n\r\n        labels[1].textContent = 'CALLSIGN:'; // Index 1\r\n        labels[3].textContent = 'ALTITUDE:'; // Index 3\r\n        labels[4].textContent = 'VELOCITY:'; // Index 4\r\n        labels[5].textContent = 'HEADING:';  // Index 5\r\n        labels[6].textContent = 'ORIGIN:';   // Index 6\r\n\r\n        // Use precise current values if possible, otherwise fallback to property\r\n        const currentTime = app.viewer.clock.currentTime;\r\n\r\n        let altMeters = 0;\r\n        const position = entity.position.getValue(currentTime);\r\n        if (position) {\r\n            const carto = Cesium.Cartographic.fromCartesian(position);\r\n            altMeters = carto.height;\r\n        } else {\r\n            altMeters = entity.properties.altitude.getValue() || 0;\r\n        }\r\n\r\n        const altFeet = Math.round(altMeters * 3.28084);\r\n        ui.altitude.textContent = `${altFeet.toLocaleString()} FT`;\r\n\r\n        // Velocity\r\n        const vel = entity.properties.velocity.getValue();\r\n        ui.velocity.textContent = `${Math.round(vel)} KTS`;\r\n\r\n        // Heading\r\n        // Ideally get current heading from orientation, but property is fine for snapshot\r\n        const hdg = entity.properties.heading.getValue();\r\n        ui.heading.textContent = `${Math.round(hdg)}¬∞`;\r\n\r\n        ui.origin.textContent = entity.properties.origin.getValue() || 'N/A';\r\n\r\n        // Show action buttons\r\n        document.getElementById('detailFollow').style.display = 'flex';\r\n        document.getElementById('detailGround').style.display = 'flex';\r\n    }\r\n}\r\n\r\n// REMOVED: updateSelectedAircraftUI \r\n// Real-time updates caused flickering and inconsistency. \r\n// Data is now static snapshots upon selection.\r\n\r\n\r\n\r\n/**\r\n * Check if bounds have changed significantly\r\n */\r\nfunction boundsChangedSignificantly(oldBounds, newBounds) {\r\n    if (!oldBounds || !newBounds) return true;\r\n\r\n    // Calculate the change in each dimension (in degrees)\r\n    const latChange = Math.abs(oldBounds.lamin - newBounds.lamin) + Math.abs(oldBounds.lamax - newBounds.lamax);\r\n    const lonChange = Math.abs(oldBounds.lomin - newBounds.lomin) + Math.abs(oldBounds.lomax - newBounds.lomax);\r\n\r\n    // Threshold: refresh if bounds changed by more than 20% of the viewport\r\n    const latThreshold = Math.abs(oldBounds.lamax - oldBounds.lamin) * 0.2;\r\n    const lonThreshold = Math.abs(oldBounds.lomax - oldBounds.lomin) * 0.2;\r\n\r\n    return latChange > latThreshold || lonChange > lonThreshold;\r\n}\r\n\r\n/**\r\n * Fetch and update aircraft for current view\r\n */\r\nasync function refreshAircraftData() {\r\n    const newBounds = getCameraViewportBounds();\r\n\r\n    // Only fetch if bounds changed significantly\r\n    if (boundsChangedSignificantly(app.lastFetchBounds, newBounds)) {\r\n        console.log('üìç Camera moved to new region, refreshing aircraft...');\r\n        app.lastFetchBounds = newBounds;\r\n        const data = await fetchAircraftData(newBounds);\r\n        updateAircraftDisplay(data);\r\n    }\r\n}\r\n\r\n/**\r\n * Setup camera movement listener\r\n */\r\nfunction setupCameraListener() {\r\n    if (!app.viewer) return;\r\n\r\n    // Listen for camera movement end (debounced)\r\n    app.viewer.camera.moveEnd.addEventListener(() => {\r\n        // Clear existing timeout\r\n        if (app.cameraMoveTimeout) {\r\n            clearTimeout(app.cameraMoveTimeout);\r\n        }\r\n\r\n        // Debounce: wait 500ms after camera stops moving\r\n        app.cameraMoveTimeout = setTimeout(() => {\r\n            refreshAircraftData();\r\n        }, 500);\r\n    });\r\n}\r\n\r\n/**\r\n * Start data update loop\r\n */\r\nfunction startDataLoop() {\r\n    // Initial fetch\r\n    refreshAircraftData();\r\n\r\n    // Update every 30 seconds to stay within OpenSky rate limits\r\n    // With 4000 credits/day: 4000 √∑ 24 hours = ~166 requests/hour = ~2880 requests/day (safe buffer)\r\n    // 30 seconds = 2 requests/minute = 120 requests/hour = 2880 requests/day ‚úÖ\r\n    app.updateInterval = setInterval(async () => {\r\n        refreshAircraftData();\r\n    }, 30000); // 30 seconds = 30,000 milliseconds\r\n\r\n    // Setup camera movement listener for immediate updates when navigating\r\n    setupCameraListener();\r\n}\r\n\r\n/**\r\n * Hide loading screen\r\n */\r\nfunction hideLoadingScreen() {\r\n    const loadingScreen = document.getElementById('loadingScreen');\r\n    if (loadingScreen) {\r\n        loadingScreen.classList.add('fade-out');\r\n        setTimeout(() => {\r\n            loadingScreen.style.display = 'none';\r\n        }, 500);\r\n    }\r\n}\r\n\r\n/**\r\n * Render airports based on visibility filter\r\n */\r\nfunction renderAirports() {\r\n    if (!app.viewer) return;\r\n\r\n    // Clear existing airports first (to avoid duplicates or update style)\r\n    // We'll use a specific ID prefix or manage a collection\r\n    // Simple approach: Use entities with a specific property\r\n\r\n    // Actually, improved approach: Create them once, and just toggle 'show'\r\n\r\n    const entities = app.viewer.entities.values;\r\n    const airportEntities = entities.filter(e => e.properties && e.properties.type && e.properties.type.getValue() === 'airport');\r\n\r\n    if (airportEntities.length === 0 && app.filters.showAirports) {\r\n        // Create airports if they don't exist and we want to show them\r\n        AIRPORTS.forEach(airport => {\r\n            app.viewer.entities.add({\r\n                position: Cesium.Cartesian3.fromDegrees(airport.lon, airport.lat, airport.alt),\r\n                point: {\r\n                    pixelSize: 10,\r\n                    color: Cesium.Color.fromCssColorString('#00ff41').withAlpha(0.6),\r\n                    outlineColor: Cesium.Color.BLACK,\r\n                    outlineWidth: 2,\r\n                    disableDepthTestDistance: Number.POSITIVE_INFINITY\r\n                },\r\n                label: {\r\n                    text: airport.name, // Display Name\r\n                    font: '10px JetBrains Mono',\r\n                    style: Cesium.LabelStyle.FILL_AND_OUTLINE,\r\n                    fillColor: Cesium.Color.fromCssColorString('#00ff41'),\r\n                    outlineColor: Cesium.Color.BLACK,\r\n                    outlineWidth: 2,\r\n                    verticalOrigin: Cesium.VerticalOrigin.TOP,\r\n                    pixelOffset: new Cesium.Cartesian2(0, 10),\r\n                    distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 100000), // Only show labels when close\r\n                    disableDepthTestDistance: Number.POSITIVE_INFINITY\r\n                },\r\n                properties: {\r\n                    type: 'airport',\r\n                    name: airport.name,\r\n                    icao: airport.icao\r\n                }\r\n            });\r\n        });\r\n    } else {\r\n        // Update visibility\r\n        airportEntities.forEach(entity => {\r\n            entity.show = app.filters.showAirports;\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Initialize application\r\n */\r\nasync function init() {\r\n    try {\r\n        updateStatus('INITIALIZING');\r\n\r\n        // Initialize Cesium\r\n        await initCesiumViewer();\r\n\r\n        // Setup UI\r\n        setupEventListeners();\r\n\r\n        // Initial render of airports\r\n        renderAirports();\r\n\r\n        // Start data updates\r\n        startDataLoop();\r\n\r\n        // Hide loading screen\r\n        setTimeout(hideLoadingScreen, 1000);\r\n\r\n\r\n        updateStatus('OPERATIONAL');\r\n    } catch (error) {\r\n        console.error('Initialization error:', error);\r\n        updateStatus('INITIALIZATION FAILED', true);\r\n    }\r\n}\r\n\r\n// Start application when DOM is ready\r\nif (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n} else {\r\n    init();\r\n}\r\n"],"names":["fetchAirportDetails","response","error","loadRunwaySurfaces","viewer","app","data","dataSource","Cesium","icao","details","longestRunway","maxLength","feature","positions","cartesians","length","i","airportEntity","p1","p2","center","CESIUM_ION_TOKEN","OPENSKY_USERNAME","OPENSKY_PASSWORD","MAX_AIRCRAFT_DISPLAY","ICAO_AIRLINES","AIRPORTS","initCesiumViewer","layer","scene","updateCamera","createSelectionBracket","initializeAirports","size","canvas","ctx","color","thickness","len","hiddenIcaos","airport","shouldHideVisuals","entityOptions","getCameraViewportBounds","camera","topLeft","topRight","bottomLeft","bottomRight","corners","cartesian","cartographic","lats","c","lons","fetchAircraftData","bounds","bbox","isProduction","url","errorText","_a","updateStatus","rateLimitRemaining","rateLimitReset","filterAircraftForDisplay","aircraftData","validAircraft","state","longitude","latitude","baro_altitude","on_ground","geo_altitude","query","callsign","_b","origin","_c","sorted","a","b","altA","predictPosition","altitude","velocity","heading","verticalRate","seconds","EARTH_RADIUS","headingRad","distance","latRad","deltaLat","deltaLon","newLatitude","newLongitude","newAltitude","createInterpolatedPosition","entity","currentTime","futureTime","positionProperty","startPosition","visualPosition","predicted","futurePosition","updateAircraftDisplay","entities","currentIds","icao24","origin_country","time_position","last_contact","true_track","vertical_rate","sensors","squawk","spi","position_source","id","trackId","velocityMs","verticalRateMs","trackEntity","visualEntity","time","result","pos","carto","groundPos","MODEL_OFFSET_X","MODEL_OFFSET_Y","MODEL_OFFSET_Z","translationCallback","x","y","z","nodeTransform","transformations","cameraPos","entityPos","dist","near","far","allEntities","totalAvailable","stopCameraModes","position","orientation","headingPitchRange","targetPos","direction","startTracking","setTraceVisibility","startFollowing","startGroundView","text","isError","statusText","statusIndicator","setupEventListeners","searchInput","handleSearch","click","pickedObjects","targetEntity","picked","showAircraftDetails","_d","_e","_f","_g","updateDebugUI","_h","offsetText","err","_i","event","controlKeys","debugPanel","step","setupFilterListeners","visible","toggleTraces","toggleAirports","renderAirports","runwayDS","renderSearchResults","results","performSearch","e","geoResults","res","resultsContainer","item","index","selectSearchResult","type","getAirlinerFromCallsign","code","getFlightNumberFromCallsign","iata","number","match","panel","isAirport","titleEl","labels","ui","airportPos","el","altMeters","altFeet","vel","hdg","boundsChangedSignificantly","oldBounds","newBounds","latChange","lonChange","latThreshold","lonThreshold","refreshAircraftData","setupCameraListener","startDataLoop","hideLoadingScreen","loadingScreen","airportEntities","init"],"mappings":"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"}