(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=i(a);fetch(a.href,o)}})();async function re(){try{const t=await fetch("/assets/airport_details.json");if(!t.ok)throw new Error("Failed to load airport details");return await t.json()}catch(t){return console.error("âŒ Error fetching airport details:",t),null}}async function se(t,n,i=null){console.log("Loading airport surfaces...");try{if(i||(i=await re()),!i)return;const r=new Cesium.CustomDataSource("airport-surfaces");t.dataSources.add(r),Object.entries(i).forEach(([a,o])=>{let s=null,l=0;if(o.runways&&o.runways.forEach(d=>{const p=d.geometry.coordinates.flat(),c=Cesium.Cartesian3.fromDegreesArray(p);r.entities.add({corridor:{positions:c,width:45,material:Cesium.Color.fromCssColorString("#00ff41").withAlpha(.3),cornerType:Cesium.CornerType.MITERED,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,2e5)},properties:{type:"airport",icao:a,name:`Airport ${a}`}});let f=0;for(let m=0;m<c.length-1;m++)f+=Cesium.Cartesian3.distance(c[m],c[m+1]);f>l&&(l=f,s=c)}),o.taxiways&&o.taxiways.forEach(d=>{const p=d.geometry.coordinates.flat();r.entities.add({corridor:{positions:Cesium.Cartesian3.fromDegreesArray(p),width:20,material:Cesium.Color.fromCssColorString("#00ff41").withAlpha(.15),cornerType:Cesium.CornerType.ROUNDED,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,2e5)},properties:{type:"airport",icao:a,name:`Airport ${a}`}})}),s){const d=t.entities.getById(`airport-${a}`);if(d){console.log(`[SkyNeedle] Upgrading airport ${a} - Hiding generic label/pin`);const u=s[0],p=s[s.length-1],c=Cesium.Cartesian3.midpoint(u,p,new Cesium.Cartesian3);d.position=c,d.billboard&&(d.billboard.show=!1)}else console.warn(`[SkyNeedle] Airport entity 'airport-${a}' not found in viewer entities`)}else console.log(`[SkyNeedle] No main runway found for ${a}, generic label remains visible`)}),console.log("âœ… Airport surfaces loaded and labels updated")}catch(r){console.error("âŒ Error loading airport details:",r)}}const le="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3N2VmNjQ5YS00MzNiLTRjODUtYTYwMS1hZjIwOGM3YWFkMDUiLCJpZCI6MzgwMzQwLCJpYXQiOjE3Njg3NDA5ODB9.ILdx02CrRUguqA-msX6n5l9-NRFuF6oHPGtqlgabJB4",R="",ce="",S=500,B={THY:{name:"Turkish Airlines",iata:"TK"},PGT:{name:"Pegasus Airlines",iata:"PC"},BAW:{name:"British Airways",iata:"BA"},DLH:{name:"Lufthansa",iata:"LH"},AFR:{name:"Air France",iata:"AF"},KLM:{name:"KLM Royal Dutch",iata:"KL"},UAE:{name:"Emirates",iata:"EK"},QTR:{name:"Qatar Airways",iata:"QR"},ETD:{name:"Etihad Airways",iata:"EY"},DL:{name:"Delta Air Lines",iata:"DL"},AAL:{name:"American Airlines",iata:"AA"},UAL:{name:"United Airlines",iata:"UA"},RYR:{name:"Ryanair",iata:"FR"},EZY:{name:"EasyJet",iata:"U2"},WZZ:{name:"Wizz Air",iata:"W6"},SWR:{name:"Swiss International",iata:"LX"},AZA:{name:"Alitalia",iata:"AZ"},TAP:{name:"TAP Air Portugal",iata:"TP"},LOT:{name:"LOT Polish Airlines",iata:"LO"},ELY:{name:"El Al",iata:"LY"},FDB:{name:"FlyDubai",iata:"FZ"},RJA:{name:"Royal Jordanian",iata:"RJ"},MEA:{name:"Middle East Airlines",iata:"ME"},MSR:{name:"EgyptAir",iata:"MS"},RAM:{name:"Royal Air Maroc",iata:"AT"},ETH:{name:"Ethiopian Airlines",iata:"ET"},SVA:{name:"Saudia",iata:"SV"},QFA:{name:"Qantas",iata:"QF"},JAL:{name:"Japan Airlines",iata:"JL"},ANA:{name:"All Nippon Airways",iata:"NH"},CPA:{name:"Cathay Pacific",iata:"CX"},PIA:{name:"Pakistan International",iata:"PK"},AIC:{name:"Air India",iata:"AI"},CCA:{name:"Air China",iata:"CA"},CES:{name:"China Eastern",iata:"MU"},CSN:{name:"China Southern",iata:"CZ"},MAS:{name:"Malaysia Airlines",iata:"MH"},SIA:{name:"Singapore Airlines",iata:"SQ"},THA:{name:"Thai Airways",iata:"TG"},KAL:{name:"Korean Air",iata:"KE"},ANZ:{name:"Air New Zealand",iata:"NZ"},ACA:{name:"Air Canada",iata:"AC"},AMX:{name:"Aeromexico",iata:"AM"},LAN:{name:"LATAM Airlines",iata:"LA"},AVA:{name:"Avianca",iata:"AV"}},z=[{name:"Istanbul Airport",icao:"LTFM",lat:41.275,lon:28.751,alt:99},{name:"Sabiha Gokcen",icao:"LTFJ",lat:40.898,lon:29.309,alt:93},{name:"Ankara Esenboga",icao:"LTAC",lat:40.128,lon:32.995,alt:953},{name:"Izmir Adnan Menderes",icao:"LTBJ",lat:38.292,lon:27.157,alt:126},{name:"Antalya Airport",icao:"LTAI",lat:36.899,lon:30.801,alt:54},{name:"Milas-Bodrum",icao:"LTFE",lat:37.25,lon:27.664,alt:6},{name:"Dalaman Airport",icao:"LTBS",lat:36.716,lon:28.791,alt:6},{name:"Adana Sakirpasa",icao:"LTAF",lat:36.982,lon:35.28,alt:20},{name:"Trabzon Airport",icao:"LTCG",lat:40.995,lon:39.789,alt:31},{name:"JFK International",icao:"KJFK",lat:40.645,lon:-73.785,alt:10},{name:"Heathrow Airport",icao:"EGLL",lat:51.47,lon:-.454,alt:25},{name:"Frankfurt Airport",icao:"EDDF",lat:50.037,lon:8.562,alt:111},{name:"Dubai International",icao:"OMDB",lat:25.253,lon:55.365,alt:19}];Cesium.Ion.defaultAccessToken=le;const e={viewer:null,selectedAircraft:null,aircraftEntities:new Map,updateInterval:null,lastFetchBounds:null,cameraMoveTimeout:null,lastAircraftData:[],filters:{showAirports:!0,showTraces:!1},searchQuery:"",trackedEntity:null,followMode:"NONE",geocoder:null,searchTimeout:null,debugMode:!1,debugOffsets:{x:0,y:0,z:0},selectionBracket:null};async function de(){console.log("Initializing Cesium viewer..."),console.log("Environment check:",{hasUsername:!1,username:"(not set)",hasPassword:!1}),e.viewer=new Cesium.Viewer("cesiumContainer",{terrain:Cesium.Terrain.fromWorldTerrain(),baseLayer:function(){const n=Cesium.ImageryLayer.fromWorldImagery({style:Cesium.IonWorldImageryStyle.AERIAL});return n.brightness=.6,n.contrast=1.2,n.saturation=.2,n}(),animation:!1,timeline:!1,infoBox:!1,selectionIndicator:!1,baseLayerPicker:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,navigationHelpButton:!1,fullscreenButton:!1,skyAtmosphere:!1,requestRenderMode:!1,maximumRenderTimeChange:1/0}),e.viewer.clock.shouldAnimate=!0,e.viewer.clock.clockRange=Cesium.ClockRange.UNBOUNDED;const t=e.viewer.scene;t.globe.baseColor=Cesium.Color.fromCssColorString("#0a0e14"),t.backgroundColor=Cesium.Color.fromCssColorString("#000000"),t.globe.enableLighting=!1,e.geocoder=new Cesium.IonGeocoderService({scene:t}),t.light=new Cesium.DirectionalLight({direction:new Cesium.Cartesian3(0,0,-1),intensity:2}),e.viewer.camera.setView({destination:Cesium.Cartesian3.fromDegrees(27.43,37.04,2e5),orientation:{heading:0,pitch:-Cesium.Math.PI_OVER_TWO,roll:0}}),e.viewer.scene.preUpdate.addEventListener(Ce),ue(),me(),se(e.viewer),console.log("Cesium viewer initialized")}function ue(){if(!e.viewer)return;const t=64,n=document.createElement("canvas");n.width=t,n.height=t;const i=n.getContext("2d"),r="#00ff41",a=4,o=16;i.strokeStyle=r,i.lineWidth=a,i.lineCap="round",i.beginPath(),i.moveTo(a,a+o),i.lineTo(a,a),i.lineTo(a+o,a),i.stroke(),i.beginPath(),i.moveTo(t-a-o,a),i.lineTo(t-a,a),i.lineTo(t-a,a+o),i.stroke(),i.beginPath(),i.moveTo(a,t-a-o),i.lineTo(a,t-a),i.lineTo(a+o,t-a),i.stroke(),i.beginPath(),i.moveTo(t-a-o,t-a),i.lineTo(t-a,t-a),i.lineTo(t-a,t-a-o),i.stroke(),e.selectionBracket=e.viewer.entities.add({id:"selection-bracket",show:!1,billboard:{image:n,scale:1,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.CENTER,disableDepthTestDistance:Number.POSITIVE_INFINITY,pixelOffset:new Cesium.Cartesian2(0,0)}})}function me(t=[]){e.viewer&&(new Cesium.PinBuilder,z.forEach(n=>{const i=t.includes(n.icao),r={id:`airport-${n.icao}`,position:Cesium.Cartesian3.fromDegrees(n.lon,n.lat,n.alt),properties:{type:"airport",name:n.name,icao:n.icao}};i||(r.point={pixelSize:8,color:Cesium.Color.WHITE.withAlpha(.8),outlineColor:Cesium.Color.BLACK,outlineWidth:1,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,show:new Cesium.CallbackProperty(()=>e.filters.showAirports,!1),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,5e6)},r.label={text:n.name,font:"12px Inter, sans-serif",style:Cesium.LabelStyle.FILL_AND_OUTLINE,fillColor:Cesium.Color.WHITE,outlineColor:Cesium.Color.BLACK,outlineWidth:2,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,-10),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,5e5),show:new Cesium.CallbackProperty(()=>e.filters.showAirports,!1)}),e.viewer.entities.add(r)}))}function j(){if(!e.viewer)return null;const t=e.viewer.camera,n=e.viewer.scene.canvas,i=t.pickEllipsoid(new Cesium.Cartesian2(0,0),e.viewer.scene.globe.ellipsoid),r=t.pickEllipsoid(new Cesium.Cartesian2(n.clientWidth,0),e.viewer.scene.globe.ellipsoid),a=t.pickEllipsoid(new Cesium.Cartesian2(0,n.clientHeight),e.viewer.scene.globe.ellipsoid),o=t.pickEllipsoid(new Cesium.Cartesian2(n.clientWidth,n.clientHeight),e.viewer.scene.globe.ellipsoid);if(!i||!r||!a||!o)return null;const s=[i,r,a,o].map(u=>{const p=Cesium.Cartographic.fromCartesian(u);return{lat:Cesium.Math.toDegrees(p.latitude),lon:Cesium.Math.toDegrees(p.longitude)}}),l=s.map(u=>u.lat),d=s.map(u=>u.lon);return{lamin:Math.max(-90,Math.min(...l)),lamax:Math.min(90,Math.max(...l)),lomin:Math.max(-180,Math.min(...d)),lomax:Math.min(180,Math.max(...d))}}async function fe(t=null){var n;try{let i=t;i||(i=j()),i||(console.log("Camera view too wide, fetching limited region"),i={lamin:35.8,lamax:42.1,lomin:25.6,lomax:44.8}),console.log("Fetching aircraft for bounds:",i);const r=window.location.hostname==="ozlphrt.github.io",o=`${r?"https://skyneedle-api.onrender.com":""}/api/states/all?lamin=${i.lamin}&lomin=${i.lomin}&lamax=${i.lamax}&lomax=${i.lomax}`;console.log(`API Request: ${r?"PRODUCTION":"DEVELOPMENT"} â†’ ${o}`);const s=await fetch(o);if(!s.ok){const d=await s.text();throw console.error("âŒ API Error:",{status:s.status,statusText:s.statusText,response:d}),s.status===401?console.error("ðŸ”’ Authentication failed - check server logs"):s.status===429&&console.error("â±ï¸ Rate limit exceeded - reduce request frequency"),new Error(`OpenSky API error: ${s.status} ${s.statusText}`)}const l=await s.json();return console.log(`âœ… Fetched ${((n=l.states)==null?void 0:n.length)||0} aircraft in viewport`),l.states||[]}catch(i){return console.error("âŒ Error fetching aircraft data:",i),i.message.includes("Failed to fetch")||i.message.includes("NetworkError")?(console.error('ðŸ’¡ Is the proxy server running? Run "npm run server" in a separate terminal.'),h("ERROR: PROXY DISCONNECTED",!0),[]):(h("ERROR: API UNAVAILABLE",!0),[])}}window.testOpenSkyAuth=async function(){var n;console.log("ðŸ” Testing OpenSky API Authentication..."),console.log("---");const t="https://opensky-network.org/api/states/all?lamin=40&lamax=41&lomin=-74&lomax=-73";try{const i=await fetch(t,{headers:R?{Authorization:"Basic "+btoa(`${R}:${ce}`)}:{}}),r=i.headers.get("X-Rate-Limit-Remaining"),a=i.headers.get("X-Rate-Limit-Reset");if(console.log("âœ… API Connection Status:"),console.log(`   Status: ${i.status} ${i.statusText}`),console.log(`   Authenticated: ${R?"âœ… Yes":"âŒ No (Anonymous)"}`),console.log(`   Username: ${R||"(none)"}`),console.log(`   Rate Limit Remaining: ${r||"Unknown"}`),console.log(`   Rate Limit Reset: ${a?new Date(a*1e3).toLocaleString():"Unknown"}`),i.ok){const o=await i.json();console.log(`   Aircraft in test area: ${((n=o.states)==null?void 0:n.length)||0}`),console.log("---"),console.log("âœ… API is working correctly!")}else console.log("---"),console.log(`âŒ API Error: ${i.status}`),i.status===401?console.log("   â†’ Check your username and password in .env file"):i.status===429&&console.log("   â†’ Rate limit exceeded. Wait or reduce request frequency.")}catch(i){console.log("---"),console.log("âŒ Connection Error:",i.message)}};function pe(t){const n=t.filter(r=>{var u,p,c;const[,,,,,a,o,s,l,,,,,d]=r;if(!a||!o||l)return!1;if(e.searchQuery){const f=e.searchQuery,m=((u=r[1])==null?void 0:u.trim().toUpperCase())||"",g=((p=r[0])==null?void 0:p.toUpperCase())||"",w=((c=r[2])==null?void 0:c.toUpperCase())||"";if(!m.includes(f)&&!g.includes(f)&&!w.includes(f))return!1}return!0});if(n.length<=S)return n;const i=n.sort((r,a)=>{const o=r[7]||r[13]||0;return(a[7]||a[13]||0)-o});return console.log(`âš ï¸ Limiting display: ${n.length} aircraft available, showing top ${S} by altitude`),i.slice(0,S)}function ge(t,n,i,r,a,o,s){if(!r||r===0)return{longitude:t,latitude:n,altitude:i};const l=6371e3,d=Cesium.Math.toRadians(a),u=r*s,p=Cesium.Math.toRadians(n),c=u*Math.cos(d)/l,f=u*Math.sin(d)/(l*Math.cos(p)),m=n+Cesium.Math.toDegrees(c),g=t+Cesium.Math.toDegrees(f),w=i+(o||0)*s;return{longitude:g,latitude:m,altitude:Math.max(0,w)}}function Z(t,n,i,r,a,o,s){const l=e.viewer?e.viewer.clock.currentTime:Cesium.JulianDate.now(),d=Cesium.JulianDate.addSeconds(l,60,new Cesium.JulianDate);let u,p;if(t&&t.position instanceof Cesium.SampledPositionProperty){u=t.position;const m=t.position.getValue(l);m?p=m:p=Cesium.Cartesian3.fromDegrees(n,i,r),u.removeSamples(new Cesium.TimeInterval({start:l,stop:Cesium.JulianDate.addSeconds(l,3600,new Cesium.JulianDate)})),u.removeSamples(new Cesium.TimeInterval({start:Cesium.JulianDate.addSeconds(l,-3600,new Cesium.JulianDate),stop:Cesium.JulianDate.addSeconds(l,-300,new Cesium.JulianDate)}))}else u=new Cesium.SampledPositionProperty,u.setInterpolationOptions({interpolationDegree:2,interpolationAlgorithm:Cesium.HermitePolynomialApproximation}),p=Cesium.Cartesian3.fromDegrees(n,i,r);u.addSample(l,p);const c=ge(n,i,r,a,o,s,60),f=Cesium.Cartesian3.fromDegrees(c.longitude,c.latitude,c.altitude);return u.addSample(d,f),u}function $(t){if(!e.viewer)return;t?e.lastAircraftData=t:t=e.lastAircraftData;const n=e.viewer.entities,i=new Set;pe(t).forEach(s=>{const[l,d,u,p,c,f,m,g,w,y,W,ie,xe,N,ke,Re,Se]=s,L=l,M=`${L}-track`;i.add(L),i.add(M);const K=g||N||0,G=(y||0)*.51444,Y=ie||0,x=W||0;let C=n.getById(M),A=n.getById(L),T;C?(T=Z(C,f,m,K,G,x,Y),C.position!==T&&(C.position=T)):(T=Z(null,f,m,K,G,x,Y),C=n.add({id:M,position:T,orientation:new Cesium.VelocityOrientationProperty(T),point:{pixelSize:1,color:Cesium.Color.RED.withAlpha(0),outlineWidth:0},path:{leadTime:0,trailTime:300,width:10,material:Cesium.Color.YELLOW.withAlpha(.25),show:new Cesium.CallbackProperty(()=>e.filters.showTraces,!1)},polyline:{positions:new Cesium.CallbackProperty((P,b)=>{const v=C.position.getValue(P);if(!v)return b;const O=Cesium.Cartographic.fromCartesian(v),E=Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(O.longitude),Cesium.Math.toDegrees(O.latitude),0);return[v,E]},!1),width:1,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.WHITE.withAlpha(.2),dashLength:16}),show:new Cesium.CallbackProperty(()=>e.filters.showTraces?e.selectedAircraft&&(e.selectedAircraft.id===L||e.selectedAircraft.id===M)?!0:e.viewer.camera.positionCartographic.height>5e4:!1,!1),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,1e6)}}));const ne=55.4,oe=-55,ae=-10;if(A)A.label.text=(d==null?void 0:d.trim())||l,A.properties.altitude=Math.round(g||N||0),A.properties.velocity=Math.round(y||0),A.properties.heading=Math.round(x),A.orientation!==C.orientation&&(A.orientation=C.orientation),A.position!==C.position&&(A.position=C.position);else{const P=new Cesium.CallbackProperty((O,E)=>{const k=ne+e.debugOffsets.x,D=oe+e.debugOffsets.y,I=ae+e.debugOffsets.z;return E?(E.x=k,E.y=D,E.z=I,E):new Cesium.Cartesian3(k,D,I)},!1),b=new Cesium.NodeTransformationProperty({translation:P}),v={Sketchfab_model:b,"ba14754abb1947bba7d9b51a2bc63084.fbx":b,RootNode:b};A=n.add({id:L,position:C.position,orientation:C.orientation,model:{uri:"/assets/boeing_767-200er.glb",minimumPixelSize:32,maximumScale:200,runAnimations:!1,nodeTransformations:v,scale:new Cesium.CallbackProperty((O,E)=>{const k=e.viewer.camera.positionWC,D=C.position.getValue(O);if(!D)return 1;const I=Cesium.Cartesian3.distance(k,D),F=5e4,J=5e5;return I<F?1:I>J?0:1-(I-F)/(J-F)},!1),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,5e5)},label:{text:(d==null?void 0:d.trim())||l,font:'bold 14px "JetBrains Mono", monospace',fillColor:Cesium.Color.fromCssColorString("#00ff41"),outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,-20),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,5e5),translucencyByDistance:new Cesium.NearFarScalar(5e4,1,5e5,0),disableDepthTestDistance:Number.POSITIVE_INFINITY},properties:{callsign:(d==null?void 0:d.trim())||"N/A",altitude:Math.round(g||N||0),velocity:Math.round(y||0),heading:Math.round(x),origin:u,type:"aircraft"}})}});const a=n.values;for(let s=a.length-1;s>=0;s--){const l=a[s];l.id!=="selection-bracket"&&(l.properties&&l.properties.type&&l.properties.type.getValue()==="airport"||i.has(l.id)||n.remove(l))}const o=t.filter(s=>{const[,,,,,l,d,,u]=s;return l&&d&&!u}).length;o>S?h(`TRACKING ${i.size}/${o} AIRCRAFT`):h(`TRACKING ${i.size} AIRCRAFT`),e.viewer.scene.requestRender()}function Ce(){if(!e.viewer||!e.trackedEntity||e.followMode==="NONE")return;const t=e.trackedEntity;if(!e.viewer.entities.contains(t)){X();return}const n=t.position.getValue(e.viewer.clock.currentTime);if(n){if(e.followMode==="TRACK")e.viewer.trackedEntity!==t&&(e.viewer.trackedEntity=t);else if(e.followMode==="FOLLOW"){let i=0;const r=t.orientation?t.orientation.getValue(e.viewer.clock.currentTime):null;r?i=Cesium.HeadingPitchRoll.fromQuaternion(r).heading:i=Cesium.Math.toRadians(t.properties.heading.getValue()||0);const a=500;e.viewer.trackedEntity&&(e.viewer.trackedEntity=void 0);const o=new Cesium.HeadingPitchRange(i,Cesium.Math.toRadians(-20),a);e.viewer.camera.lookAt(n,o)}else if(e.followMode==="GROUND"){const i=t.position.getValue(e.viewer.clock.currentTime);if(!i||!e.groundCameraPos)return;const r=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(i,e.groundCameraPos,new Cesium.Cartesian3),new Cesium.Cartesian3);e.viewer.camera.setView({destination:e.groundCameraPos,orientation:{direction:r,up:Cesium.Cartesian3.normalize(e.groundCameraPos,new Cesium.Cartesian3)}})}}}function X(){e.followMode="NONE",e.trackedEntity=null,e.viewer.trackedEntity=void 0,e.viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)}function he(t){t&&(e.followMode==="FOLLOW"&&e.viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),e.trackedEntity=t,e.followMode="TRACK",e.viewer.trackedEntity=t,h(`TRACKING ${t.properties.callsign||t.id}`),H(!0))}function ye(t){t&&(e.trackedEntity=t,e.followMode="FOLLOW",h(`FOLLOWING ${t.properties.callsign||t.id}`),H(!0))}function Ae(t){if(!t)return;const n=t.position.getValue(e.viewer.clock.currentTime);if(!n)return;const i=Cesium.Cartographic.fromCartesian(n),r=Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(i.longitude),Cesium.Math.toDegrees(i.latitude),10);e.trackedEntity=t,e.followMode="GROUND",e.groundCameraPos=r,e.viewer.trackedEntity=void 0,e.viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),e.viewer.camera.flyTo({destination:r,orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(45),roll:0},duration:2}),h(`GROUND VIEW: ${t.properties.callsign||t.id}`)}function h(t,n=!1){const i=document.querySelector(".status-text"),r=document.querySelector(".status-indicator");i&&(i.textContent=t),r&&(r.style.background=n?"#ff4444":"#00ff41")}function we(){var i,r,a,o,s,l,d,u,p;const t=document.getElementById("searchInput");t==null||t.addEventListener("input",Ee),(i=document.getElementById("closeDetails"))==null||i.addEventListener("click",()=>{var c;(c=document.getElementById("aircraftDetails"))==null||c.classList.add("hidden"),e.selectedAircraft=null,e.selectionBracket&&(e.selectionBracket.show=!1)}),new Cesium.ScreenSpaceEventHandler(e.viewer.scene.canvas).setInputAction(c=>{var m;const f=e.viewer.scene.drillPick(c.position);if(Cesium.defined(f)&&f.length>0){let g=null;for(let w=0;w<f.length;w++){const y=f[w];if((typeof y.id=="string"?y.id:y.id?y.id.id:null)!=="selection-bracket"&&y.id instanceof Cesium.Entity){g=y.id;break}}g&&V(g)}else(m=document.getElementById("aircraftDetails"))==null||m.classList.add("hidden"),e.selectedAircraft=null,e.selectionBracket&&(e.selectionBracket.show=!1)},Cesium.ScreenSpaceEventType.LEFT_CLICK),(r=document.getElementById("detailOverview"))==null||r.addEventListener("click",()=>{X(),H(!1),e.viewer.camera.cancelFlight(),e.viewer.camera.setView({destination:Cesium.Cartesian3.fromDegrees(27.43,37.04,2e5),orientation:{heading:0,pitch:-Cesium.Math.PI_OVER_TWO,roll:0}})}),(a=document.getElementById("detailTrack"))==null||a.addEventListener("click",()=>{e.selectedAircraft&&he(e.selectedAircraft)}),(o=document.getElementById("detailFollow"))==null||o.addEventListener("click",()=>{e.selectedAircraft&&ye(e.selectedAircraft)}),(s=document.getElementById("detailGround"))==null||s.addEventListener("click",()=>{e.selectedAircraft&&Ae(e.selectedAircraft)}),(l=document.getElementById("closeDebug"))==null||l.addEventListener("click",()=>{var c;e.debugMode=!1,(c=document.getElementById("debugPanel"))==null||c.classList.add("hidden")}),(d=document.getElementById("resetOffsets"))==null||d.addEventListener("click",()=>{e.debugOffsets.x=0,e.debugOffsets.y=0,e.debugOffsets.z=0,q(),console.log("ðŸ”§ Offsets reset to zero")}),(u=document.getElementById("copyOffsets"))==null||u.addEventListener("click",()=>{const c=`// Aircraft Model Offsets
const MODEL_OFFSET_X = ${e.debugOffsets.x.toFixed(2)}; // Left/Right
const MODEL_OFFSET_Y = ${e.debugOffsets.y.toFixed(2)}; // Forward/Backward
const MODEL_OFFSET_Z = ${e.debugOffsets.z.toFixed(2)}; // Up/Down`;navigator.clipboard.writeText(c).then(()=>{console.log("âœ… Offset values copied to clipboard!"),console.log(c),alert("Offset values copied to clipboard!")}).catch(f=>{console.error("âŒ Failed to copy:",f)})}),(p=document.getElementById("applyOffsets"))==null||p.addEventListener("click",()=>{console.log("âœ… Offsets saved and will be applied to all aircraft:",e.debugOffsets),alert(`Offsets applied: X=${e.debugOffsets.x.toFixed(2)}m, Y=${e.debugOffsets.y.toFixed(2)}m, Z=${e.debugOffsets.z.toFixed(2)}m`)}),document.addEventListener("keydown",c=>{const f=["w","a","s","d","q","e","W","A","S","D","Q","E"];if(c.ctrlKey&&c.shiftKey&&c.altKey&&c.key.toLowerCase()==="d"){c.preventDefault(),e.debugMode=!e.debugMode;const g=document.getElementById("debugPanel");e.debugMode?(g==null||g.classList.remove("hidden"),console.log("ðŸ”§ Debug Mode ENABLED - Use WASDQE keys to adjust aircraft position")):(g==null||g.classList.add("hidden"),console.log("ðŸ”§ Debug Mode DISABLED"));return}if(!e.debugMode||!e.selectedAircraft)return;f.includes(c.key)&&c.preventDefault();let m=1;switch(c.shiftKey&&(m=.1),c.ctrlKey&&(m=10),c.key.toLowerCase()){case"a":e.debugOffsets.x-=m;break;case"d":e.debugOffsets.x+=m;break;case"w":e.debugOffsets.y+=m;break;case"s":e.debugOffsets.y-=m;break;case"q":e.debugOffsets.z-=m;break;case"e":e.debugOffsets.z+=m;break;default:return}q(),console.log(`ðŸ”§ Offset adjusted: X=${e.debugOffsets.x.toFixed(2)}, Y=${e.debugOffsets.y.toFixed(2)}, Z=${e.debugOffsets.z.toFixed(2)}`)}),ee()}function q(){document.getElementById("debugOffsetX").textContent=`${e.debugOffsets.x.toFixed(2)} m`,document.getElementById("debugOffsetY").textContent=`${e.debugOffsets.y.toFixed(2)} m`,document.getElementById("debugOffsetZ").textContent=`${e.debugOffsets.z.toFixed(2)} m`,ee()}function H(t){var i,r;e.filters.showTraces=t;const n=document.getElementById("toggleTraces");n&&n.classList.toggle("active",t),(r=(i=e.viewer)==null?void 0:i.scene)==null||r.requestRender()}function ee(){const t=document.getElementById("toggleAirports"),n=document.getElementById("toggleTraces");t==null||t.addEventListener("click",()=>{e.filters.showAirports=!e.filters.showAirports,t.classList.toggle("active",e.filters.showAirports),te();const i=e.viewer.dataSources.getByName("airport-surfaces");i&&i.length>0&&(i[0].show=e.filters.showAirports)}),n==null||n.addEventListener("click",()=>{e.filters.showTraces=!e.filters.showTraces,n.classList.toggle("active",e.filters.showTraces),e.viewer.scene.requestRender()})}function Ee(t){const n=t.target.value.trim().toUpperCase();if(e.searchQuery=n,e.searchTimeout&&clearTimeout(e.searchTimeout),!n){_([]),$();return}e.searchTimeout=setTimeout(async()=>{console.log("Searching for:",n);const i=await Te(n);_(i),$()},300)}async function Te(t){if(!t||t.length<2)return[];const n=[];z.filter(o=>o.name.toUpperCase().includes(t)||o.icao.toUpperCase().includes(t)).forEach(o=>n.push({type:"AIRPORT",label:`${o.icao} - ${o.name}`,data:o,id:`airport-${o.icao}`})),e.viewer.entities.values.filter(o=>o.properties&&o.properties.type&&o.properties.type.getValue()==="aircraft"&&(o.properties.callsign.getValue().toUpperCase().includes(t)||o.id.toUpperCase().includes(t))).forEach(o=>n.push({type:"FLIGHT",label:`${o.properties.callsign.getValue()} (${o.id})`,data:o,id:o.id}));try{const o=await e.geocoder.geocode(t);o&&o.length>0&&o.forEach(s=>n.push({type:"CITY",label:s.displayName,data:s,id:`geo-${s.displayName}`}))}catch(o){console.error("Geocoder error:",o)}return n}function _(t){const n=document.getElementById("searchResults");if(n){if(t.length===0){n.innerHTML="",n.style.display="none";return}n.innerHTML=t.map(i=>`
        <div class="search-result-item" data-id="${i.id}">
            <span class="result-type">[${i.type}]</span>
            <span class="result-label">${i.label}</span>
        </div>
    `).join(""),n.style.display="block",n.querySelectorAll(".search-result-item").forEach((i,r)=>{i.addEventListener("click",()=>{Ie(t[r])})})}}function Ie(t){const{type:n,data:i,id:r}=t;console.log("Selected search result:",t);const a=document.getElementById("searchInput");if(a&&(a.value=""),_([]),e.searchQuery="",n==="CITY")e.viewer.camera.flyTo({destination:i.destination,duration:3}),h(`VIEWING: ${i.displayName.toUpperCase()}`);else if(n==="AIRPORT"){const o=e.viewer.entities.getById(r);o?(e.viewer.flyTo(o,{offset:new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-45),25e3),duration:3}),V(o)):e.viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(i.lon,i.lat,25e3),duration:3})}else if(n==="FLIGHT"){const o=e.viewer.entities.getById(r);o&&(e.viewer.camera.flyTo({destination:o.position.getValue(e.viewer.clock.currentTime),offset:new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-45),5e3),duration:3}),V(o))}}function Le(t){var i;const n=t.substring(0,3).trim();return((i=B[n])==null?void 0:i.name)||"PRIVATE/CHARTER"}function be(t){const n=t.substring(0,3).toUpperCase();if(B[n]){const r=B[n].iata;let a=t.substring(3).trim();return a=a.replace(/^0+/,""),`${r} ${a}`}const i=t.match(/^([A-Z]+)(\d+.*)$/);return i?`${i[1]} ${i[2]}`:t}function V(t){e.selectedAircraft=t,e.selectionBracket&&(e.selectionBracket.position=t.position,e.selectionBracket.show=!0);const n=document.getElementById("aircraftDetails");n==null||n.classList.remove("hidden");const i=t.properties&&t.properties.type&&t.properties.type.getValue()==="airport",r=document.querySelector(".panel-title"),a=document.querySelectorAll(".data-label");document.querySelectorAll(".data-value");const o={airliner:document.getElementById("detailAirliner"),flightNum:document.getElementById("detailFlightNum"),callsign:document.getElementById("detailCallsign"),altitude:document.getElementById("detailAltitude"),velocity:document.getElementById("detailVelocity"),heading:document.getElementById("detailHeading"),origin:document.getElementById("detailOrigin")};if(i){r.textContent="AIRPORT DATA",o.airliner&&(o.airliner.parentElement.style.display="none"),o.flightNum&&(o.flightNum.parentElement.style.display="none"),a[1].textContent="NAME:",o.callsign.textContent=t.properties.name.getValue(),a[3].textContent="ALTITUDE:";const s=t.position.getValue(e.viewer.clock.currentTime),l=Cesium.Cartographic.fromCartesian(s);o.altitude.textContent=`${Math.round(l.height)} M`,a[4].textContent="ICAO:",o.velocity.textContent=t.properties.icao.getValue(),a[5].textContent="LAT:",o.heading.textContent=Cesium.Math.toDegrees(l.latitude).toFixed(4),a[6].textContent="LON:",o.origin.textContent=Cesium.Math.toDegrees(l.longitude).toFixed(4),document.getElementById("detailFollow").style.display="none",document.getElementById("detailGround").style.display="none"}else{r.textContent="AIRCRAFT DATA",Object.values(o).forEach(m=>{m&&(m.parentElement.style.display="flex")}),o.airliner.textContent="...",o.flightNum.textContent="...",o.callsign.textContent="...",o.altitude.textContent="...",o.velocity.textContent="...",o.heading.textContent="...",o.origin.textContent="...";const s=t.properties.callsign.getValue()||"N/A";o.airliner.textContent=Le(s),o.flightNum.textContent=be(s),o.callsign.textContent=s,a[1].textContent="CALLSIGN:",a[3].textContent="ALTITUDE:",a[4].textContent="VELOCITY:",a[5].textContent="HEADING:",a[6].textContent="ORIGIN:";const l=e.viewer.clock.currentTime;let d=0;const u=t.position.getValue(l);u?d=Cesium.Cartographic.fromCartesian(u).height:d=t.properties.altitude.getValue()||0;const p=Math.round(d*3.28084);o.altitude.textContent=`${p.toLocaleString()} FT`;const c=t.properties.velocity.getValue();o.velocity.textContent=`${Math.round(c)} KTS`;const f=t.properties.heading.getValue();o.heading.textContent=`${Math.round(f)}Â°`,o.origin.textContent=t.properties.origin.getValue()||"N/A",document.getElementById("detailFollow").style.display="flex",document.getElementById("detailGround").style.display="flex"}}function ve(t,n){if(!t||!n)return!0;const i=Math.abs(t.lamin-n.lamin)+Math.abs(t.lamax-n.lamax),r=Math.abs(t.lomin-n.lomin)+Math.abs(t.lomax-n.lomax),a=Math.abs(t.lamax-t.lamin)*.2,o=Math.abs(t.lomax-t.lomin)*.2;return i>a||r>o}async function U(){const t=j();if(ve(e.lastFetchBounds,t)){console.log("ðŸ“ Camera moved to new region, refreshing aircraft..."),e.lastFetchBounds=t;const n=await fe(t);$(n)}}function Oe(){e.viewer&&e.viewer.camera.moveEnd.addEventListener(()=>{e.cameraMoveTimeout&&clearTimeout(e.cameraMoveTimeout),e.cameraMoveTimeout=setTimeout(()=>{U()},500)})}function De(){U(),e.updateInterval=setInterval(async()=>{U()},3e4),Oe()}function Me(){const t=document.getElementById("loadingScreen");t&&(t.classList.add("fade-out"),setTimeout(()=>{t.style.display="none"},500))}function te(){if(!e.viewer)return;const n=e.viewer.entities.values.filter(i=>i.properties&&i.properties.type&&i.properties.type.getValue()==="airport");n.length===0&&e.filters.showAirports?z.forEach(i=>{e.viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(i.lon,i.lat,i.alt),point:{pixelSize:10,color:Cesium.Color.fromCssColorString("#00ff41").withAlpha(.6),outlineColor:Cesium.Color.BLACK,outlineWidth:2,disableDepthTestDistance:Number.POSITIVE_INFINITY},label:{text:i.name,font:"10px JetBrains Mono",style:Cesium.LabelStyle.FILL_AND_OUTLINE,fillColor:Cesium.Color.fromCssColorString("#00ff41"),outlineColor:Cesium.Color.BLACK,outlineWidth:2,verticalOrigin:Cesium.VerticalOrigin.TOP,pixelOffset:new Cesium.Cartesian2(0,10),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,1e5),disableDepthTestDistance:Number.POSITIVE_INFINITY},properties:{type:"airport",name:i.name,icao:i.icao}})}):n.forEach(i=>{i.show=e.filters.showAirports})}async function Q(){try{h("INITIALIZING"),await de(),we(),te(),De(),setTimeout(Me,1e3),h("OPERATIONAL")}catch(t){console.error("Initialization error:",t),h("INITIALIZATION FAILED",!0)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Q):Q();
//# sourceMappingURL=index-BZLr79W2.js.map
