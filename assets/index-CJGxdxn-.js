import*as i from"cesium";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();async function se(){try{const t=await fetch("/SkyNeedle/assets/airport_details.json");if(!t.ok)throw new Error("Failed to load airport details");return await t.json()}catch(t){return console.error("âŒ Error fetching airport details:",t),null}}async function le(t,o,n=null){console.log("Loading airport surfaces...");try{if(n||(n=await se()),!n)return;const s=new i.CustomDataSource("airport-surfaces");t.dataSources.add(s),Object.entries(n).forEach(([r,a])=>{let l=null,c=0;if(a.runways&&a.runways.forEach(u=>{const g=u.geometry.coordinates.flat(),d=i.Cartesian3.fromDegreesArray(g);s.entities.add({corridor:{positions:d,width:45,material:i.Color.fromCssColorString("#00ff41").withAlpha(.3),cornerType:i.CornerType.MITERED,heightReference:i.HeightReference.CLAMP_TO_GROUND,distanceDisplayCondition:new i.DistanceDisplayCondition(0,2e5)},properties:{type:"airport",icao:r,name:`Airport ${r}`}});let p=0;for(let m=0;m<d.length-1;m++)p+=i.Cartesian3.distance(d[m],d[m+1]);p>c&&(c=p,l=d)}),a.taxiways&&a.taxiways.forEach(u=>{const g=u.geometry.coordinates.flat();s.entities.add({corridor:{positions:i.Cartesian3.fromDegreesArray(g),width:20,material:i.Color.fromCssColorString("#00ff41").withAlpha(.15),cornerType:i.CornerType.ROUNDED,heightReference:i.HeightReference.CLAMP_TO_GROUND,distanceDisplayCondition:new i.DistanceDisplayCondition(0,2e5)},properties:{type:"airport",icao:r,name:`Airport ${r}`}})}),l){const u=t.entities.getById(`airport-${r}`);if(u){console.log(`[SkyNeedle] Upgrading airport ${r} - Hiding generic label/pin`);const f=l[0],g=l[l.length-1],d=i.Cartesian3.midpoint(f,g,new i.Cartesian3);u.position=d,u.billboard&&(u.billboard.show=!1)}else console.warn(`[SkyNeedle] Airport entity 'airport-${r}' not found in viewer entities`)}else console.log(`[SkyNeedle] No main runway found for ${r}, generic label remains visible`)}),console.log("âœ… Airport surfaces loaded and labels updated")}catch(s){console.error("âŒ Error loading airport details:",s)}}const ce="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3N2VmNjQ5YS00MzNiLTRjODUtYTYwMS1hZjIwOGM3YWFkMDUiLCJpZCI6MzgwMzQwLCJpYXQiOjE3Njg3NDA5ODB9.ILdx02CrRUguqA-msX6n5l9-NRFuF6oHPGtqlgabJB4",S="",de="",N=500,$={THY:{name:"Turkish Airlines",iata:"TK"},PGT:{name:"Pegasus Airlines",iata:"PC"},BAW:{name:"British Airways",iata:"BA"},DLH:{name:"Lufthansa",iata:"LH"},AFR:{name:"Air France",iata:"AF"},KLM:{name:"KLM Royal Dutch",iata:"KL"},UAE:{name:"Emirates",iata:"EK"},QTR:{name:"Qatar Airways",iata:"QR"},ETD:{name:"Etihad Airways",iata:"EY"},DL:{name:"Delta Air Lines",iata:"DL"},AAL:{name:"American Airlines",iata:"AA"},UAL:{name:"United Airlines",iata:"UA"},RYR:{name:"Ryanair",iata:"FR"},EZY:{name:"EasyJet",iata:"U2"},WZZ:{name:"Wizz Air",iata:"W6"},SWR:{name:"Swiss International",iata:"LX"},AZA:{name:"Alitalia",iata:"AZ"},TAP:{name:"TAP Air Portugal",iata:"TP"},LOT:{name:"LOT Polish Airlines",iata:"LO"},ELY:{name:"El Al",iata:"LY"},FDB:{name:"FlyDubai",iata:"FZ"},RJA:{name:"Royal Jordanian",iata:"RJ"},MEA:{name:"Middle East Airlines",iata:"ME"},MSR:{name:"EgyptAir",iata:"MS"},RAM:{name:"Royal Air Maroc",iata:"AT"},ETH:{name:"Ethiopian Airlines",iata:"ET"},SVA:{name:"Saudia",iata:"SV"},QFA:{name:"Qantas",iata:"QF"},JAL:{name:"Japan Airlines",iata:"JL"},ANA:{name:"All Nippon Airways",iata:"NH"},CPA:{name:"Cathay Pacific",iata:"CX"},PIA:{name:"Pakistan International",iata:"PK"},AIC:{name:"Air India",iata:"AI"},CCA:{name:"Air China",iata:"CA"},CES:{name:"China Eastern",iata:"MU"},CSN:{name:"China Southern",iata:"CZ"},MAS:{name:"Malaysia Airlines",iata:"MH"},SIA:{name:"Singapore Airlines",iata:"SQ"},THA:{name:"Thai Airways",iata:"TG"},KAL:{name:"Korean Air",iata:"KE"},ANZ:{name:"Air New Zealand",iata:"NZ"},ACA:{name:"Air Canada",iata:"AC"},AMX:{name:"Aeromexico",iata:"AM"},LAN:{name:"LATAM Airlines",iata:"LA"},AVA:{name:"Avianca",iata:"AV"}},H=[{name:"Istanbul Airport",icao:"LTFM",lat:41.275,lon:28.751,alt:99},{name:"Sabiha Gokcen",icao:"LTFJ",lat:40.898,lon:29.309,alt:93},{name:"Ankara Esenboga",icao:"LTAC",lat:40.128,lon:32.995,alt:953},{name:"Izmir Adnan Menderes",icao:"LTBJ",lat:38.292,lon:27.157,alt:126},{name:"Antalya Airport",icao:"LTAI",lat:36.899,lon:30.801,alt:54},{name:"Milas-Bodrum",icao:"LTFE",lat:37.25,lon:27.664,alt:6},{name:"Dalaman Airport",icao:"LTBS",lat:36.716,lon:28.791,alt:6},{name:"Adana Sakirpasa",icao:"LTAF",lat:36.982,lon:35.28,alt:20},{name:"Trabzon Airport",icao:"LTCG",lat:40.995,lon:39.789,alt:31},{name:"JFK International",icao:"KJFK",lat:40.645,lon:-73.785,alt:10},{name:"Heathrow Airport",icao:"EGLL",lat:51.47,lon:-.454,alt:25},{name:"Frankfurt Airport",icao:"EDDF",lat:50.037,lon:8.562,alt:111},{name:"Dubai International",icao:"OMDB",lat:25.253,lon:55.365,alt:19}];i.Ion.defaultAccessToken=ce;const e={viewer:null,selectedAircraft:null,aircraftEntities:new Map,updateInterval:null,lastFetchBounds:null,cameraMoveTimeout:null,lastAircraftData:[],filters:{showAirports:!0,showTraces:!1},searchQuery:"",trackedEntity:null,followMode:"NONE",geocoder:null,searchTimeout:null,debugMode:!1,debugOffsets:{x:0,y:0,z:0},selectionBracket:null};async function ue(){console.log("Initializing Cesium viewer..."),console.log("Environment check:",{hasUsername:!1,username:"(not set)",hasPassword:!1}),e.viewer=new i.Viewer("cesiumContainer",{terrain:i.Terrain.fromWorldTerrain(),baseLayer:function(){const o=i.ImageryLayer.fromWorldImagery({style:i.IonWorldImageryStyle.AERIAL});return o.brightness=.6,o.contrast=1.2,o.saturation=.2,o}(),animation:!1,timeline:!1,infoBox:!1,selectionIndicator:!1,baseLayerPicker:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,navigationHelpButton:!1,fullscreenButton:!1,skyAtmosphere:!1,requestRenderMode:!1,maximumRenderTimeChange:1/0}),e.viewer.clock.shouldAnimate=!0,e.viewer.clock.clockRange=i.ClockRange.UNBOUNDED;const t=e.viewer.scene;t.globe.baseColor=i.Color.fromCssColorString("#0a0e14"),t.backgroundColor=i.Color.fromCssColorString("#000000"),t.globe.enableLighting=!1,e.geocoder=new i.IonGeocoderService({scene:t}),t.light=new i.DirectionalLight({direction:new i.Cartesian3(0,0,-1),intensity:2}),e.viewer.camera.setView({destination:i.Cartesian3.fromDegrees(27.43,37.04,2e5),orientation:{heading:0,pitch:-i.Math.PI_OVER_TWO,roll:0}}),e.viewer.scene.preUpdate.addEventListener(ye),fe(),me(),le(e.viewer),console.log("Cesium viewer initialized")}function fe(){if(!e.viewer)return;const t=64,o=document.createElement("canvas");o.width=t,o.height=t;const n=o.getContext("2d"),s="#00ff41",r=4,a=16;n.strokeStyle=s,n.lineWidth=r,n.lineCap="round",n.beginPath(),n.moveTo(r,r+a),n.lineTo(r,r),n.lineTo(r+a,r),n.stroke(),n.beginPath(),n.moveTo(t-r-a,r),n.lineTo(t-r,r),n.lineTo(t-r,r+a),n.stroke(),n.beginPath(),n.moveTo(r,t-r-a),n.lineTo(r,t-r),n.lineTo(r+a,t-r),n.stroke(),n.beginPath(),n.moveTo(t-r-a,t-r),n.lineTo(t-r,t-r),n.lineTo(t-r,t-r-a),n.stroke(),e.selectionBracket=e.viewer.entities.add({id:"selection-bracket",show:!1,billboard:{image:o,scale:1,horizontalOrigin:i.HorizontalOrigin.CENTER,verticalOrigin:i.VerticalOrigin.CENTER,disableDepthTestDistance:Number.POSITIVE_INFINITY,pixelOffset:new i.Cartesian2(0,0)}})}function me(t=[]){e.viewer&&(new i.PinBuilder,H.forEach(o=>{const n=t.includes(o.icao),s={id:`airport-${o.icao}`,position:i.Cartesian3.fromDegrees(o.lon,o.lat,o.alt),properties:{type:"airport",name:o.name,icao:o.icao}};n||(s.point={pixelSize:8,color:i.Color.WHITE.withAlpha(.8),outlineColor:i.Color.BLACK,outlineWidth:1,heightReference:i.HeightReference.CLAMP_TO_GROUND,show:new i.CallbackProperty(()=>e.filters.showAirports,!1),distanceDisplayCondition:new i.DistanceDisplayCondition(0,5e6)},s.label={text:o.name,font:"12px Inter, sans-serif",style:i.LabelStyle.FILL_AND_OUTLINE,fillColor:i.Color.WHITE,outlineColor:i.Color.BLACK,outlineWidth:2,verticalOrigin:i.VerticalOrigin.BOTTOM,pixelOffset:new i.Cartesian2(0,-10),distanceDisplayCondition:new i.DistanceDisplayCondition(0,5e5),show:new i.CallbackProperty(()=>e.filters.showAirports,!1)}),e.viewer.entities.add(s)}))}function X(){if(!e.viewer)return null;const t=e.viewer.camera,o=e.viewer.scene.canvas,n=t.pickEllipsoid(new i.Cartesian2(0,0),e.viewer.scene.globe.ellipsoid),s=t.pickEllipsoid(new i.Cartesian2(o.clientWidth,0),e.viewer.scene.globe.ellipsoid),r=t.pickEllipsoid(new i.Cartesian2(0,o.clientHeight),e.viewer.scene.globe.ellipsoid),a=t.pickEllipsoid(new i.Cartesian2(o.clientWidth,o.clientHeight),e.viewer.scene.globe.ellipsoid);if(!n||!s||!r||!a)return null;const l=[n,s,r,a].map(f=>{const g=i.Cartographic.fromCartesian(f);return{lat:i.Math.toDegrees(g.latitude),lon:i.Math.toDegrees(g.longitude)}}),c=l.map(f=>f.lat),u=l.map(f=>f.lon);return{lamin:Math.max(-90,Math.min(...c)),lamax:Math.min(90,Math.max(...c)),lomin:Math.max(-180,Math.min(...u)),lomax:Math.min(180,Math.max(...u))}}async function pe(t=null){var o;try{let n=t;n||(n=X()),n||(console.log("Camera view too wide, fetching limited region"),n={lamin:35.8,lamax:42.1,lomin:25.6,lomax:44.8}),console.log("Fetching aircraft for bounds:",n);const s=window.location.hostname==="ozlphrt.github.io",a=`${s?"https://skyneedle-api.onrender.com":""}/api/states/all?lamin=${n.lamin}&lomin=${n.lomin}&lamax=${n.lamax}&lomax=${n.lomax}`;console.log(`API Request: ${s?"PRODUCTION":"DEVELOPMENT"} â†’ ${a}`);const l=await fetch(a);if(!l.ok){const u=await l.text();throw console.error("âŒ API Error:",{status:l.status,statusText:l.statusText,response:u}),l.status===401?console.error("ðŸ”’ Authentication failed - check server logs"):l.status===429&&console.error("â±ï¸ Rate limit exceeded - reduce request frequency"),new Error(`OpenSky API error: ${l.status} ${l.statusText}`)}const c=await l.json();return console.log(`âœ… Fetched ${((o=c.states)==null?void 0:o.length)||0} aircraft in viewport`),c.states||[]}catch(n){return console.error("âŒ Error fetching aircraft data:",n),n.message.includes("Failed to fetch")||n.message.includes("NetworkError")?(console.error('ðŸ’¡ Is the proxy server running? Run "npm run server" in a separate terminal.'),A("ERROR: PROXY DISCONNECTED",!0),[]):(A("ERROR: API UNAVAILABLE",!0),[])}}window.testOpenSkyAuth=async function(){var o;console.log("ðŸ” Testing OpenSky API Authentication..."),console.log("---");const t="https://opensky-network.org/api/states/all?lamin=40&lamax=41&lomin=-74&lomax=-73";try{const n=await fetch(t,{headers:S?{Authorization:"Basic "+btoa(`${S}:${de}`)}:{}}),s=n.headers.get("X-Rate-Limit-Remaining"),r=n.headers.get("X-Rate-Limit-Reset");if(console.log("âœ… API Connection Status:"),console.log(`   Status: ${n.status} ${n.statusText}`),console.log(`   Authenticated: ${S?"âœ… Yes":"âŒ No (Anonymous)"}`),console.log(`   Username: ${S||"(none)"}`),console.log(`   Rate Limit Remaining: ${s||"Unknown"}`),console.log(`   Rate Limit Reset: ${r?new Date(r*1e3).toLocaleString():"Unknown"}`),n.ok){const a=await n.json();console.log(`   Aircraft in test area: ${((o=a.states)==null?void 0:o.length)||0}`),console.log("---"),console.log("âœ… API is working correctly!")}else console.log("---"),console.log(`âŒ API Error: ${n.status}`),n.status===401?console.log("   â†’ Check your username and password in .env file"):n.status===429&&console.log("   â†’ Rate limit exceeded. Wait or reduce request frequency.")}catch(n){console.log("---"),console.log("âŒ Connection Error:",n.message)}};function ge(t){const o=t.filter(s=>{var f,g,d;const[,,,,,r,a,l,c,,,,,u]=s;if(!r||!a||c)return!1;if(e.searchQuery){const p=e.searchQuery,m=((f=s[1])==null?void 0:f.trim().toUpperCase())||"",h=((g=s[0])==null?void 0:g.toUpperCase())||"",E=((d=s[2])==null?void 0:d.toUpperCase())||"";if(!m.includes(p)&&!h.includes(p)&&!E.includes(p))return!1}return!0});if(o.length<=N)return o;const n=o.sort((s,r)=>{const a=s[7]||s[13]||0;return(r[7]||r[13]||0)-a});return console.log(`âš ï¸ Limiting display: ${o.length} aircraft available, showing top ${N} by altitude`),n.slice(0,N)}function he(t,o,n,s,r,a,l){if(!s||s===0)return{longitude:t,latitude:o,altitude:n};const c=6371e3,u=i.Math.toRadians(r),f=s*l,g=i.Math.toRadians(o),d=f*Math.cos(u)/c,p=f*Math.sin(u)/(c*Math.cos(g)),m=o+i.Math.toDegrees(d),h=t+i.Math.toDegrees(p),E=n+(a||0)*l;return{longitude:h,latitude:m,altitude:Math.max(0,E)}}function q(t,o,n,s,r,a,l){const c=e.viewer?e.viewer.clock.currentTime:i.JulianDate.now(),u=i.JulianDate.addSeconds(c,60,new i.JulianDate);let f,g;if(t&&t.position instanceof i.SampledPositionProperty){f=t.position;const m=t.position.getValue(c);m?g=m:g=i.Cartesian3.fromDegrees(o,n,s),f.removeSamples(new i.TimeInterval({start:c,stop:i.JulianDate.addSeconds(c,3600,new i.JulianDate)})),f.removeSamples(new i.TimeInterval({start:i.JulianDate.addSeconds(c,-3600,new i.JulianDate),stop:i.JulianDate.addSeconds(c,-300,new i.JulianDate)}))}else f=new i.SampledPositionProperty,f.setInterpolationOptions({interpolationDegree:2,interpolationAlgorithm:i.HermitePolynomialApproximation}),g=i.Cartesian3.fromDegrees(o,n,s);f.addSample(c,g);const d=he(o,n,s,r,a,l,60),p=i.Cartesian3.fromDegrees(d.longitude,d.latitude,d.altitude);return f.addSample(u,p),f}function _(t){if(!e.viewer)return;t?e.lastAircraftData=t:t=e.lastAircraftData;const o=e.viewer.entities,n=new Set;ge(t).forEach(l=>{const[c,u,f,g,d,p,m,h,E,C,K,ne,xe,P,Re,Se,Ne]=l,b=c,k=`${b}-track`;n.add(b),n.add(k);const G=h||P||0,Y=(C||0)*.51444,J=ne||0,x=K||0;let y=o.getById(k),w=o.getById(b),I;y?(I=q(y,p,m,G,Y,x,J),y.position!==I&&(y.position=I)):(I=q(null,p,m,G,Y,x,J),y=o.add({id:k,position:I,orientation:new i.VelocityOrientationProperty(I),point:{pixelSize:1,color:i.Color.RED.withAlpha(0),outlineWidth:0},path:{leadTime:0,trailTime:300,width:10,material:i.Color.YELLOW.withAlpha(.25),show:new i.CallbackProperty(()=>e.filters.showTraces,!1)},polyline:{positions:new i.CallbackProperty((F,v)=>{const O=y.position.getValue(F);if(!O)return v;const D=i.Cartographic.fromCartesian(O),T=i.Cartesian3.fromDegrees(i.Math.toDegrees(D.longitude),i.Math.toDegrees(D.latitude),0);return[O,T]},!1),width:1,material:new i.PolylineDashMaterialProperty({color:i.Color.WHITE.withAlpha(.2),dashLength:16}),show:new i.CallbackProperty(()=>e.filters.showTraces?e.selectedAircraft&&(e.selectedAircraft.id===b||e.selectedAircraft.id===k)?!0:e.viewer.camera.positionCartographic.height>5e4:!1,!1),distanceDisplayCondition:new i.DistanceDisplayCondition(0,1e6)}}));const oe=55.4,ae=-55,re=-10;if(w)w.label.text=(u==null?void 0:u.trim())||c,w.properties.altitude=Math.round(h||P||0),w.properties.velocity=Math.round(C||0),w.properties.heading=Math.round(x),w.orientation!==y.orientation&&(w.orientation=y.orientation),w.position!==y.position&&(w.position=y.position);else{const F=new i.CallbackProperty((D,T)=>{const R=oe+e.debugOffsets.x,M=ae+e.debugOffsets.y,L=re+e.debugOffsets.z;return T?(T.x=R,T.y=M,T.z=L,T):new i.Cartesian3(R,M,L)},!1),v=new i.NodeTransformationProperty({translation:F}),O={Sketchfab_model:v,"ba14754abb1947bba7d9b51a2bc63084.fbx":v,RootNode:v};w=o.add({id:b,position:y.position,orientation:y.orientation,model:{uri:"/SkyNeedle/assets/boeing_767-200er.glb",minimumPixelSize:32,maximumScale:200,runAnimations:!1,nodeTransformations:O,scale:new i.CallbackProperty((D,T)=>{const R=e.viewer.camera.positionWC,M=y.position.getValue(D);if(!M)return 1;const L=i.Cartesian3.distance(R,M),B=5e4,Z=5e5;return L<B?1:L>Z?0:1-(L-B)/(Z-B)},!1),distanceDisplayCondition:new i.DistanceDisplayCondition(0,5e5)},label:{text:(u==null?void 0:u.trim())||c,font:'bold 14px "JetBrains Mono", monospace',fillColor:i.Color.fromCssColorString("#00ff41"),outlineColor:i.Color.BLACK,outlineWidth:2,style:i.LabelStyle.FILL_AND_OUTLINE,verticalOrigin:i.VerticalOrigin.BOTTOM,pixelOffset:new i.Cartesian2(0,-20),distanceDisplayCondition:new i.DistanceDisplayCondition(0,5e5),translucencyByDistance:new i.NearFarScalar(5e4,1,5e5,0),disableDepthTestDistance:Number.POSITIVE_INFINITY},properties:{callsign:(u==null?void 0:u.trim())||"N/A",altitude:Math.round(h||P||0),velocity:Math.round(C||0),heading:Math.round(x),origin:f,type:"aircraft"}})}});const r=o.values;for(let l=r.length-1;l>=0;l--){const c=r[l];c.id!=="selection-bracket"&&(c.properties&&c.properties.type&&c.properties.type.getValue()==="airport"||n.has(c.id)||o.remove(c))}const a=t.filter(l=>{const[,,,,,c,u,,f]=l;return c&&u&&!f}).length;a>N?A(`TRACKING ${n.size}/${a} AIRCRAFT`):A(`TRACKING ${n.size} AIRCRAFT`),e.viewer.scene.requestRender()}function ye(){if(!e.viewer||!e.trackedEntity||e.followMode==="NONE")return;const t=e.trackedEntity;if(!e.viewer.entities.contains(t)){ee();return}const o=t.position.getValue(e.viewer.clock.currentTime);if(o){if(e.followMode==="TRACK")e.viewer.trackedEntity!==t&&(e.viewer.trackedEntity=t);else if(e.followMode==="FOLLOW"){let n=0;const s=t.orientation?t.orientation.getValue(e.viewer.clock.currentTime):null;s?n=i.HeadingPitchRoll.fromQuaternion(s).heading:n=i.Math.toRadians(t.properties.heading.getValue()||0);const r=500;e.viewer.trackedEntity&&(e.viewer.trackedEntity=void 0);const a=new i.HeadingPitchRange(n,i.Math.toRadians(-20),r);e.viewer.camera.lookAt(o,a)}else if(e.followMode==="GROUND"){const n=t.position.getValue(e.viewer.clock.currentTime);if(!n||!e.groundCameraPos)return;const s=i.Cartesian3.normalize(i.Cartesian3.subtract(n,e.groundCameraPos,new i.Cartesian3),new i.Cartesian3);e.viewer.camera.setView({destination:e.groundCameraPos,orientation:{direction:s,up:i.Cartesian3.normalize(e.groundCameraPos,new i.Cartesian3)}})}}}function ee(){e.followMode="NONE",e.trackedEntity=null,e.viewer.trackedEntity=void 0,e.viewer.camera.lookAtTransform(i.Matrix4.IDENTITY)}function Ae(t){t&&(e.followMode==="FOLLOW"&&e.viewer.camera.lookAtTransform(i.Matrix4.IDENTITY),e.trackedEntity=t,e.followMode="TRACK",e.viewer.trackedEntity=t,A(`TRACKING ${t.properties.callsign||t.id}`),W(!0))}function Ce(t){t&&(e.trackedEntity=t,e.followMode="FOLLOW",A(`FOLLOWING ${t.properties.callsign||t.id}`),W(!0))}function we(t){if(!t)return;const o=t.position.getValue(e.viewer.clock.currentTime);if(!o)return;const n=i.Cartographic.fromCartesian(o),s=i.Cartesian3.fromDegrees(i.Math.toDegrees(n.longitude),i.Math.toDegrees(n.latitude),10);e.trackedEntity=t,e.followMode="GROUND",e.groundCameraPos=s,e.viewer.trackedEntity=void 0,e.viewer.camera.lookAtTransform(i.Matrix4.IDENTITY),e.viewer.camera.flyTo({destination:s,orientation:{heading:i.Math.toRadians(0),pitch:i.Math.toRadians(45),roll:0},duration:2}),A(`GROUND VIEW: ${t.properties.callsign||t.id}`)}function A(t,o=!1){const n=document.querySelector(".status-text"),s=document.querySelector(".status-indicator");n&&(n.textContent=t),s&&(s.style.background=o?"#ff4444":"#00ff41")}function Ee(){var n,s,r,a,l,c,u,f,g;const t=document.getElementById("searchInput");t==null||t.addEventListener("input",Te),(n=document.getElementById("closeDetails"))==null||n.addEventListener("click",()=>{var d;(d=document.getElementById("aircraftDetails"))==null||d.classList.add("hidden"),e.selectedAircraft=null,e.selectionBracket&&(e.selectionBracket.show=!1)}),new i.ScreenSpaceEventHandler(e.viewer.scene.canvas).setInputAction(d=>{var m;const p=e.viewer.scene.drillPick(d.position);if(i.defined(p)&&p.length>0){let h=null;for(let E=0;E<p.length;E++){const C=p[E];if((typeof C.id=="string"?C.id:C.id?C.id.id:null)!=="selection-bracket"&&C.id instanceof i.Entity){h=C.id;break}}h&&U(h)}else(m=document.getElementById("aircraftDetails"))==null||m.classList.add("hidden"),e.selectedAircraft=null,e.selectionBracket&&(e.selectionBracket.show=!1)},i.ScreenSpaceEventType.LEFT_CLICK),(s=document.getElementById("detailOverview"))==null||s.addEventListener("click",()=>{ee(),W(!1),e.viewer.camera.cancelFlight(),e.viewer.camera.setView({destination:i.Cartesian3.fromDegrees(27.43,37.04,2e5),orientation:{heading:0,pitch:-i.Math.PI_OVER_TWO,roll:0}})}),(r=document.getElementById("detailTrack"))==null||r.addEventListener("click",()=>{e.selectedAircraft&&Ae(e.selectedAircraft)}),(a=document.getElementById("detailFollow"))==null||a.addEventListener("click",()=>{e.selectedAircraft&&Ce(e.selectedAircraft)}),(l=document.getElementById("detailGround"))==null||l.addEventListener("click",()=>{e.selectedAircraft&&we(e.selectedAircraft)}),(c=document.getElementById("closeDebug"))==null||c.addEventListener("click",()=>{var d;e.debugMode=!1,(d=document.getElementById("debugPanel"))==null||d.classList.add("hidden")}),(u=document.getElementById("resetOffsets"))==null||u.addEventListener("click",()=>{e.debugOffsets.x=0,e.debugOffsets.y=0,e.debugOffsets.z=0,Q(),console.log("ðŸ”§ Offsets reset to zero")}),(f=document.getElementById("copyOffsets"))==null||f.addEventListener("click",()=>{const d=`// Aircraft Model Offsets
const MODEL_OFFSET_X = ${e.debugOffsets.x.toFixed(2)}; // Left/Right
const MODEL_OFFSET_Y = ${e.debugOffsets.y.toFixed(2)}; // Forward/Backward
const MODEL_OFFSET_Z = ${e.debugOffsets.z.toFixed(2)}; // Up/Down`;navigator.clipboard.writeText(d).then(()=>{console.log("âœ… Offset values copied to clipboard!"),console.log(d),alert("Offset values copied to clipboard!")}).catch(p=>{console.error("âŒ Failed to copy:",p)})}),(g=document.getElementById("applyOffsets"))==null||g.addEventListener("click",()=>{console.log("âœ… Offsets saved and will be applied to all aircraft:",e.debugOffsets),alert(`Offsets applied: X=${e.debugOffsets.x.toFixed(2)}m, Y=${e.debugOffsets.y.toFixed(2)}m, Z=${e.debugOffsets.z.toFixed(2)}m`)}),document.addEventListener("keydown",d=>{const p=["w","a","s","d","q","e","W","A","S","D","Q","E"];if(d.ctrlKey&&d.shiftKey&&d.altKey&&d.key.toLowerCase()==="d"){d.preventDefault(),e.debugMode=!e.debugMode;const h=document.getElementById("debugPanel");e.debugMode?(h==null||h.classList.remove("hidden"),console.log("ðŸ”§ Debug Mode ENABLED - Use WASDQE keys to adjust aircraft position")):(h==null||h.classList.add("hidden"),console.log("ðŸ”§ Debug Mode DISABLED"));return}if(!e.debugMode||!e.selectedAircraft)return;p.includes(d.key)&&d.preventDefault();let m=1;switch(d.shiftKey&&(m=.1),d.ctrlKey&&(m=10),d.key.toLowerCase()){case"a":e.debugOffsets.x-=m;break;case"d":e.debugOffsets.x+=m;break;case"w":e.debugOffsets.y+=m;break;case"s":e.debugOffsets.y-=m;break;case"q":e.debugOffsets.z-=m;break;case"e":e.debugOffsets.z+=m;break;default:return}Q(),console.log(`ðŸ”§ Offset adjusted: X=${e.debugOffsets.x.toFixed(2)}, Y=${e.debugOffsets.y.toFixed(2)}, Z=${e.debugOffsets.z.toFixed(2)}`)}),te()}function Q(){document.getElementById("debugOffsetX").textContent=`${e.debugOffsets.x.toFixed(2)} m`,document.getElementById("debugOffsetY").textContent=`${e.debugOffsets.y.toFixed(2)} m`,document.getElementById("debugOffsetZ").textContent=`${e.debugOffsets.z.toFixed(2)} m`,te()}function W(t){var n,s;e.filters.showTraces=t;const o=document.getElementById("toggleTraces");o&&o.classList.toggle("active",t),(s=(n=e.viewer)==null?void 0:n.scene)==null||s.requestRender()}function te(){const t=document.getElementById("toggleAirports"),o=document.getElementById("toggleTraces");t==null||t.addEventListener("click",()=>{e.filters.showAirports=!e.filters.showAirports,t.classList.toggle("active",e.filters.showAirports),ie();const n=e.viewer.dataSources.getByName("airport-surfaces");n&&n.length>0&&(n[0].show=e.filters.showAirports)}),o==null||o.addEventListener("click",()=>{e.filters.showTraces=!e.filters.showTraces,o.classList.toggle("active",e.filters.showTraces),e.viewer.scene.requestRender()})}function Te(t){const o=t.target.value.trim().toUpperCase();if(e.searchQuery=o,e.searchTimeout&&clearTimeout(e.searchTimeout),!o){V([]),_();return}e.searchTimeout=setTimeout(async()=>{console.log("Searching for:",o);const n=await Ie(o);V(n),_()},300)}async function Ie(t){if(!t||t.length<2)return[];const o=[];H.filter(a=>a.name.toUpperCase().includes(t)||a.icao.toUpperCase().includes(t)).forEach(a=>o.push({type:"AIRPORT",label:`${a.icao} - ${a.name}`,data:a,id:`airport-${a.icao}`})),e.viewer.entities.values.filter(a=>a.properties&&a.properties.type&&a.properties.type.getValue()==="aircraft"&&(a.properties.callsign.getValue().toUpperCase().includes(t)||a.id.toUpperCase().includes(t))).forEach(a=>o.push({type:"FLIGHT",label:`${a.properties.callsign.getValue()} (${a.id})`,data:a,id:a.id}));try{const a=await e.geocoder.geocode(t);a&&a.length>0&&a.forEach(l=>o.push({type:"CITY",label:l.displayName,data:l,id:`geo-${l.displayName}`}))}catch(a){console.error("Geocoder error:",a)}return o}function V(t){const o=document.getElementById("searchResults");if(o){if(t.length===0){o.innerHTML="",o.style.display="none";return}o.innerHTML=t.map(n=>`
        <div class="search-result-item" data-id="${n.id}">
            <span class="result-type">[${n.type}]</span>
            <span class="result-label">${n.label}</span>
        </div>
    `).join(""),o.style.display="block",o.querySelectorAll(".search-result-item").forEach((n,s)=>{n.addEventListener("click",()=>{Le(t[s])})})}}function Le(t){const{type:o,data:n,id:s}=t;console.log("Selected search result:",t);const r=document.getElementById("searchInput");if(r&&(r.value=""),V([]),e.searchQuery="",o==="CITY")e.viewer.camera.flyTo({destination:n.destination,duration:3}),A(`VIEWING: ${n.displayName.toUpperCase()}`);else if(o==="AIRPORT"){const a=e.viewer.entities.getById(s);a?(e.viewer.flyTo(a,{offset:new i.HeadingPitchRange(0,i.Math.toRadians(-45),25e3),duration:3}),U(a)):e.viewer.camera.flyTo({destination:i.Cartesian3.fromDegrees(n.lon,n.lat,25e3),duration:3})}else if(o==="FLIGHT"){const a=e.viewer.entities.getById(s);a&&(e.viewer.camera.flyTo({destination:a.position.getValue(e.viewer.clock.currentTime),offset:new i.HeadingPitchRange(0,i.Math.toRadians(-45),5e3),duration:3}),U(a))}}function be(t){var n;const o=t.substring(0,3).trim();return((n=$[o])==null?void 0:n.name)||"PRIVATE/CHARTER"}function ve(t){const o=t.substring(0,3).toUpperCase();if($[o]){const s=$[o].iata;let r=t.substring(3).trim();return r=r.replace(/^0+/,""),`${s} ${r}`}const n=t.match(/^([A-Z]+)(\d+.*)$/);return n?`${n[1]} ${n[2]}`:t}function U(t){e.selectedAircraft=t,e.selectionBracket&&(e.selectionBracket.position=t.position,e.selectionBracket.show=!0);const o=document.getElementById("aircraftDetails");o==null||o.classList.remove("hidden");const n=t.properties&&t.properties.type&&t.properties.type.getValue()==="airport",s=document.querySelector(".panel-title"),r=document.querySelectorAll(".data-label");document.querySelectorAll(".data-value");const a={airliner:document.getElementById("detailAirliner"),flightNum:document.getElementById("detailFlightNum"),callsign:document.getElementById("detailCallsign"),altitude:document.getElementById("detailAltitude"),velocity:document.getElementById("detailVelocity"),heading:document.getElementById("detailHeading"),origin:document.getElementById("detailOrigin")};if(n){s.textContent="AIRPORT DATA",a.airliner&&(a.airliner.parentElement.style.display="none"),a.flightNum&&(a.flightNum.parentElement.style.display="none"),r[1].textContent="NAME:",a.callsign.textContent=t.properties.name.getValue(),r[3].textContent="ALTITUDE:";const l=t.position.getValue(e.viewer.clock.currentTime),c=i.Cartographic.fromCartesian(l);a.altitude.textContent=`${Math.round(c.height)} M`,r[4].textContent="ICAO:",a.velocity.textContent=t.properties.icao.getValue(),r[5].textContent="LAT:",a.heading.textContent=i.Math.toDegrees(c.latitude).toFixed(4),r[6].textContent="LON:",a.origin.textContent=i.Math.toDegrees(c.longitude).toFixed(4),document.getElementById("detailFollow").style.display="none",document.getElementById("detailGround").style.display="none"}else{s.textContent="AIRCRAFT DATA",Object.values(a).forEach(m=>{m&&(m.parentElement.style.display="flex")}),a.airliner.textContent="...",a.flightNum.textContent="...",a.callsign.textContent="...",a.altitude.textContent="...",a.velocity.textContent="...",a.heading.textContent="...",a.origin.textContent="...";const l=t.properties.callsign.getValue()||"N/A";a.airliner.textContent=be(l),a.flightNum.textContent=ve(l),a.callsign.textContent=l,r[1].textContent="CALLSIGN:",r[3].textContent="ALTITUDE:",r[4].textContent="VELOCITY:",r[5].textContent="HEADING:",r[6].textContent="ORIGIN:";const c=e.viewer.clock.currentTime;let u=0;const f=t.position.getValue(c);f?u=i.Cartographic.fromCartesian(f).height:u=t.properties.altitude.getValue()||0;const g=Math.round(u*3.28084);a.altitude.textContent=`${g.toLocaleString()} FT`;const d=t.properties.velocity.getValue();a.velocity.textContent=`${Math.round(d)} KTS`;const p=t.properties.heading.getValue();a.heading.textContent=`${Math.round(p)}Â°`,a.origin.textContent=t.properties.origin.getValue()||"N/A",document.getElementById("detailFollow").style.display="flex",document.getElementById("detailGround").style.display="flex"}}function Oe(t,o){if(!t||!o)return!0;const n=Math.abs(t.lamin-o.lamin)+Math.abs(t.lamax-o.lamax),s=Math.abs(t.lomin-o.lomin)+Math.abs(t.lomax-o.lomax),r=Math.abs(t.lamax-t.lamin)*.2,a=Math.abs(t.lomax-t.lomin)*.2;return n>r||s>a}async function z(){const t=X();if(Oe(e.lastFetchBounds,t)){console.log("ðŸ“ Camera moved to new region, refreshing aircraft..."),e.lastFetchBounds=t;const o=await pe(t);_(o)}}function De(){e.viewer&&e.viewer.camera.moveEnd.addEventListener(()=>{e.cameraMoveTimeout&&clearTimeout(e.cameraMoveTimeout),e.cameraMoveTimeout=setTimeout(()=>{z()},500)})}function Me(){z(),e.updateInterval=setInterval(async()=>{z()},3e4),De()}function ke(){const t=document.getElementById("loadingScreen");t&&(t.classList.add("fade-out"),setTimeout(()=>{t.style.display="none"},500))}function ie(){if(!e.viewer)return;const o=e.viewer.entities.values.filter(n=>n.properties&&n.properties.type&&n.properties.type.getValue()==="airport");o.length===0&&e.filters.showAirports?H.forEach(n=>{e.viewer.entities.add({position:i.Cartesian3.fromDegrees(n.lon,n.lat,n.alt),point:{pixelSize:10,color:i.Color.fromCssColorString("#00ff41").withAlpha(.6),outlineColor:i.Color.BLACK,outlineWidth:2,disableDepthTestDistance:Number.POSITIVE_INFINITY},label:{text:n.name,font:"10px JetBrains Mono",style:i.LabelStyle.FILL_AND_OUTLINE,fillColor:i.Color.fromCssColorString("#00ff41"),outlineColor:i.Color.BLACK,outlineWidth:2,verticalOrigin:i.VerticalOrigin.TOP,pixelOffset:new i.Cartesian2(0,10),distanceDisplayCondition:new i.DistanceDisplayCondition(0,1e5),disableDepthTestDistance:Number.POSITIVE_INFINITY},properties:{type:"airport",name:n.name,icao:n.icao}})}):o.forEach(n=>{n.show=e.filters.showAirports})}async function j(){try{A("INITIALIZING"),await ue(),Ee(),ie(),Me(),setTimeout(ke,1e3),A("OPERATIONAL")}catch(t){console.error("Initialization error:",t),A("INITIALIZATION FAILED",!0)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",j):j();
//# sourceMappingURL=index-CJGxdxn-.js.map
